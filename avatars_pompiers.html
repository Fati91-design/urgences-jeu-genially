<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Urgences – Avatar Pompiers</title>

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

  <style>
    html, body { background: transparent; margin: 0; color: #fff; }
    .page-wrap{ min-height: 100vh; display:flex; align-items:center; justify-content:center; padding: 32px 18px; position: relative; }

    .glass{
      width: min(980px, 100%);
      background: rgba(0,0,0,.42);
      border: 1px solid rgba(255,255,255,.14);
      backdrop-filter: blur(10px);
      border-radius: 22px;
      box-shadow: 0 18px 50px rgba(0,0,0,.35);
      overflow: hidden;
      position: relative;
    }

    #fx{ position:absolute; inset:0; width:100%; height:100%; pointer-events:none; opacity:.85; mix-blend-mode:screen; z-index:1; }

    .header{ padding:18px 18px 12px; border-bottom:1px solid rgba(255,255,255,.1); position:relative; z-index:2; }
    .hello{ margin:0 0 10px; font-weight:900; font-size:clamp(22px,2.4vw,34px); text-shadow:0 12px 30px rgba(0,0,0,.55); }
    .hello .name{ color:rgba(255,190,110,1); text-shadow:0 0 18px rgba(255,165,0,.35); }
    .subtitle{ margin:0; font-size:13px; color:rgba(255,255,255,.72); }

    .trio-wrap{ padding:18px; display:flex; justify-content:center; z-index:2; position:relative; }
    .trio{ width:min(760px,100%); height:420px; position:relative; display:flex; justify-content:center; align-items:flex-end; }

    .avatar-block{
      position:absolute; bottom:0; width: 220px;
      display:flex; flex-direction:column; align-items:center; gap: 10px;
    }

    .avatar-pick{
      height:330px; user-select:none; --sx:1; --ty:0px;
      transform: translateY(var(--ty)) scale(var(--sx));
      transform-origin:bottom center;
      filter:drop-shadow(0 18px 18px rgba(0,0,0,.45));
      transition:transform .16s ease, filter .16s ease, opacity .16s ease;
      opacity:.98; pointer-events:none;
    }

    .left{left:2%;--sx:.96}
    .center{left:50%;transform:translateX(-50%);--sx:1.03;z-index:3}
    .right{right:2%;--sx:.96}

    .selected{ --ty:-10px; filter:drop-shadow(0 26px 28px rgba(0,0,0,.65)) drop-shadow(0 0 18px rgba(255,165,0,.55)); z-index:6; opacity:1; }
    .dimmed{opacity:.55}

    .footer{ padding:14px 18px 18px; border-top:1px solid rgba(255,255,255,.1); display:flex; justify-content:center; align-items:center; z-index:2; position:relative; text-align:center; }
    .helpTxt{ font-size:12px; color:rgba(255,255,255,.72); }

    .btn-ember{
      border:0; border-radius:14px; padding:10px 18px;
      font-weight:900; letter-spacing:.08em; text-transform:uppercase;
      background:linear-gradient(180deg,#ffb05a,#ff7832);
      color:#0a0c12;
      box-shadow:0 16px 35px rgba(255,120,50,.22);
      transition: transform .15s ease, filter .15s ease;
    }
    .btn-ember:hover{ transform: translateY(-2px); filter: brightness(1.06); }

    @media(max-width:576px){
      .trio{height:330px}
      .avatar-pick{height:230px}
      .avatar-block{width: 160px}
      .btn-ember{padding:9px 14px; font-size:12px}
    }
  </style>
</head>

<body>
<div class="page-wrap">
  <div class="glass">
    <canvas id="fx"></canvas>

    <div class="header">
      <p class="hello" id="helloLine"></p>
      <p class="subtitle">Métier : Pompiers — valide l’avatar de ton choix.</p>
    </div>

    <div class="trio-wrap">
      <div class="trio" id="trio"></div>
    </div>

    <div class="footer">
      <div class="helpTxt" id="helpTxt">Choisis un avatar en cliquant sur “VALIDER”.</div>
    </div>
  </div>
</div>

<script>
  const ROLE = "pompier";

  const playerName = localStorage.getItem("player_name") || localStorage.getItem("playerName") || "Joueur";
  document.getElementById("helloLine").innerHTML =
    `Bonjour <span class="name">${escapeHtml(playerName)}</span>, choisis ton avatar.`;

  const avatars = [
    {pos:"left",  file:"pompier_f.png",        label:"Pompier (F)"},
    {pos:"center",file:"pompier_f_voilee.png", label:"Pompier (F voilée)"},
    {pos:"right", file:"pompier_h.png",        label:"Pompier (H)"},
  ];

  const trio = document.getElementById("trio");
  const helpTxt = document.getElementById("helpTxt");

  function render(){
    trio.innerHTML = "";
    avatars.forEach(a=>{
      const wrap = document.createElement("div");
      wrap.className = `avatar-block ${a.pos}`;
      wrap.dataset.file = a.file;

      const img = document.createElement("img");
      img.src = `assets/avatars/${a.file}`;
      img.className = `avatar-pick`;
      img.alt = a.label;

      const btn = document.createElement("button");
      btn.type = "button";
      btn.className = "btn-ember";
      btn.textContent = "VALIDER";
      btn.onclick = ()=>validate(a.file);

      wrap.appendChild(img);
      wrap.appendChild(btn);
      trio.appendChild(wrap);
    });
  }

  function validate(file){
    document.querySelectorAll(".avatar-block").forEach(b=>{
      const isSel = b.dataset.file === file;
      b.classList.toggle("selected", isSel);
      b.classList.toggle("dimmed", !isSel);
      const img = b.querySelector(".avatar-pick");
      img.classList.toggle("selected", isSel);
      img.classList.toggle("dimmed", !isSel);
    });

    localStorage.setItem("role", ROLE);
    localStorage.setItem("avatar", file);
    helpTxt.textContent = "✅ Avatar enregistré. Tu peux continuer dans Genially.";
  }

  function escapeHtml(str){
    return String(str).replace(/[&<>"']/g,m=>({
      "&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;","'":"&#039;"
    }[m]));
  }

  render();
</script>
</body>
</html>
