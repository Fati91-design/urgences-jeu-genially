<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>FIN ‚Äî URGENCES</title>

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Anton&display=swap" rel="stylesheet">

<style>
  :root{
    --glass: rgba(25,27,31,.72);
    --glass2: rgba(15,17,20,.55);
    --text: rgba(255,255,255,.93);
    --muted: rgba(255,255,255,.70);

    --gold: rgba(255,200,80,1);
    --red: rgba(255,70,70,1);
    --green: rgba(45,200,120,1);
    --blue: rgba(80,170,255,1);
    --ember: rgba(255,150,70,1);
    --ember2: rgba(255,120,50,1);

    --shadow: rgba(0,0,0,.90);
    --flash: rgba(230,245,255,.95);
  }

  html,body{
    margin:0;
    background:#000;
    color:var(--text);
    font-family: system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
    overflow:hidden;
  }

  .genially-stage{
    width:100vw; height:100vh;
    display:flex; align-items:center; justify-content:center;
    overflow:hidden;
    background:#000;
  }

  /* ‚úÖ ADAPTATION GENIALLY : 1980 x 1020 */
  .genially-page{
    width:1980px; height:1020px;
    position:relative;
    transform-origin:center;
  }

  .scene{
    position:absolute;
    inset:0;
    isolation:isolate;
    background: transparent;
    overflow:hidden;
  }

  .grade{
    position:absolute; inset:0; z-index:-6;
    background:
      radial-gradient(1000px 520px at 18% 28%, rgba(255,120,60,.24), transparent 60%),
      radial-gradient(1000px 520px at 85% 62%, rgba(80,170,255,.20), transparent 65%),
      linear-gradient(180deg, rgba(0,0,0,.12), rgba(0,0,0,.86));
    opacity:.70;
    pointer-events:none;
  }
  .vignette{
    position:absolute; inset:0; z-index:-5;
    background: radial-gradient(1400px 900px at 50% 38%, transparent 28%, rgba(0,0,0,.92) 92%);
    opacity:.62;
    pointer-events:none;
  }

  .glow{
    position:absolute; inset:0; z-index:0; pointer-events:none;
    background:
      radial-gradient(760px 320px at 16% 72%, rgba(255,90,60,.28), transparent 70%),
      radial-gradient(880px 360px at 88% 64%, rgba(80,170,255,.24), transparent 70%),
      radial-gradient(820px 340px at 55% 84%, rgba(255,220,160,.10), transparent 76%);
    mix-blend-mode: screen;
    opacity:.95;
    animation: glowPulse 2.0s ease-in-out infinite;
  }
  .fog{
    position:absolute; inset:-10%; z-index:1; pointer-events:none;
    background:
      radial-gradient(720px 320px at 30% 78%, rgba(255,255,255,.10), transparent 72%),
      radial-gradient(900px 360px at 65% 80%, rgba(255,255,255,.08), transparent 76%);
    filter: blur(10px);
    opacity:.55;
    animation: fogMove 7.5s ease-in-out infinite;
  }
  .lightning{
    position:absolute; inset:-10%;
    z-index: 4; pointer-events:none;
    opacity:0;
    background:
      radial-gradient(900px 380px at 60% 14%, rgba(230,245,255,.60), transparent 72%),
      radial-gradient(1400px 560px at 50% 18%, rgba(230,245,255,.28), transparent 80%),
      linear-gradient(180deg, rgba(230,245,255,.12), transparent);
    mix-blend-mode: screen;
  }
  .lightning.flash1{ animation: lightning1 6.2s infinite; }
  .lightning.flash2{ animation: lightning2 8.8s infinite; }

  .grain{
    position:absolute; inset:-35%;
    z-index:-4; pointer-events:none;
    opacity:.20;
    mix-blend-mode: overlay;
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='140' height='140'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='.85' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='140' height='140' filter='url(%23n)' opacity='.35'/%3E%3C/svg%3E");
    animation: grain 2.2s steps(2) infinite;
  }

  .thunderWave{
    position:absolute;
    left:50%;
    top: 18%;
    transform: translateX(-50%);
    width: min(1120px, 86%);
    height: 160px;
    z-index: 1;
    pointer-events:none;
    opacity: 0;
    background:
      radial-gradient(420px 120px at 50% 50%, rgba(230,245,255,.22), transparent 70%),
      radial-gradient(720px 160px at 50% 52%, rgba(255,255,255,.10), transparent 75%);
    filter: blur(2px);
    mix-blend-mode: screen;
    animation: thunderWave 6.2s infinite;
  }
  .thunderFlash{
    position:absolute;
    inset:-5%;
    z-index: 6;
    pointer-events:none;
    opacity:0;
    background:
      radial-gradient(1100px 520px at 55% 12%, rgba(230,245,255,.85), transparent 70%),
      radial-gradient(1600px 720px at 50% 15%, rgba(230,245,255,.25), transparent 80%),
      linear-gradient(180deg, rgba(230,245,255,.14), transparent 60%);
    mix-blend-mode: screen;
    animation: thunderFlash 6.2s infinite;
  }

  .fireGlow{
    position:absolute;
    inset:-10%;
    z-index:2;
    pointer-events:none;
    mix-blend-mode: screen;
    opacity:.75;
    background:
      radial-gradient(680px 240px at 50% 100%, rgba(255,120,60,.35), transparent 70%),
      radial-gradient(900px 320px at 20% 105%, rgba(255,200,80,.16), transparent 72%),
      radial-gradient(900px 320px at 80% 105%, rgba(255,80,80,.12), transparent 72%);
    filter: blur(10px);
    animation: fireGlow 2.6s ease-in-out infinite;
  }
  .embers{
    position:absolute;
    inset:0;
    z-index:3;
    pointer-events:none;
    opacity:.65;
    background:
      radial-gradient(2px 2px at 10% 92%, rgba(255,210,120,.95), transparent 60%),
      radial-gradient(2px 2px at 18% 96%, rgba(255,140,80,.90), transparent 60%),
      radial-gradient(2px 2px at 26% 94%, rgba(255,220,160,.92), transparent 60%),
      radial-gradient(2px 2px at 35% 98%, rgba(255,120,60,.88), transparent 60%),
      radial-gradient(2px 2px at 44% 93%, rgba(255,210,120,.92), transparent 60%),
      radial-gradient(2px 2px at 55% 97%, rgba(255,160,90,.90), transparent 60%),
      radial-gradient(2px 2px at 63% 95%, rgba(255,230,180,.90), transparent 60%),
      radial-gradient(2px 2px at 72% 98%, rgba(255,120,60,.88), transparent 60%),
      radial-gradient(2px 2px at 84% 94%, rgba(255,210,120,.92), transparent 60%),
      radial-gradient(2px 2px at 92% 97%, rgba(255,150,80,.90), transparent 60%);
    filter: blur(.2px);
    animation: embersRise 3.6s linear infinite;
  }

  .missionPill{
    position:absolute;
    top: 22px;
    left: 50%;
    transform: translateX(-50%);
    z-index: 20;
    pointer-events:none;

    display:inline-block;
    padding:8px 14px;
    border-radius:999px;
    border:1px solid rgba(255,255,255,.16);
    background: rgba(0,0,0,.36);
    backdrop-filter: blur(10px);
    box-shadow: 0 18px 60px rgba(0,0,0,.55);

    font-weight:950;
    font-size:12px;
    letter-spacing:.18em;
    text-transform:uppercase;
    color: rgba(255,255,255,.78);
  }

  .titleWrap{
    position:absolute;
    left:50%;
    transform: translateX(-50%);
    top: 92px;
    z-index: 20;
    width: min(1200px, 92%);
    text-align:center;
    pointer-events:none;
  }
  .title{
    margin:0;
    font-family:'Anton', sans-serif;
    text-transform:uppercase;
    line-height:.92;
    letter-spacing:.06em;
    font-size: 92px;
    background: linear-gradient(180deg, #d7e9ff 0%, #86bfff 40%, #cfe3ff 100%);
    -webkit-background-clip:text; background-clip:text; color:transparent;
    text-shadow: 0 22px 90px rgba(0,0,0,.72), 0 0 40px rgba(120,190,255,.18);
    animation: titleEnter 1.05s cubic-bezier(.12,.98,.18,1) .15s both;
  }
  .subtitleBig{
    margin-top: 8px;
    font-family:'Anton', sans-serif;
    text-transform:uppercase;
    letter-spacing:.08em;
    font-size: 44px;
    color: rgba(255,255,255,.98);
    text-shadow: 0 26px 90px rgba(0,0,0,.75), 0 0 28px rgba(255,255,255,.08);
    animation: subtitleEnter .9s cubic-bezier(.12,.98,.18,1) .32s both;
  }

  .endPanel{
    position:absolute;
    left:50%;
    top: 56%;
    transform: translate(-50%,-50%);
    z-index: 25;
    width: min(1500px, 92%);
    border-radius: 28px;
    background: rgba(0,0,0,.30);
    border: 1px solid rgba(255,255,255,.14);
    box-shadow: 0 26px 120px rgba(0,0,0,.75);
    overflow:hidden;
  }
  .endPanel::before{
    content:"";
    position:absolute; inset:-2px;
    background:
      radial-gradient(900px 260px at 30% 0%, rgba(255,150,70,.14), transparent 60%),
      radial-gradient(900px 260px at 75% 120%, rgba(80,170,255,.10), transparent 60%);
    opacity:.9;
    pointer-events:none;
  }
  .panelInner{
    position:relative;
    z-index:2;
    padding: 18px 18px 16px;
  }

  .endGrid{
    display:grid;
    grid-template-columns: 320px 1fr;
    gap: 16px;
    align-items: stretch;
  }

  .badgeBox{
    border-radius: 24px;
    border: 1px solid rgba(255,255,255,.14);
    background: rgba(0,0,0,.22);
    box-shadow: 0 20px 70px rgba(0,0,0,.35);
    padding: 16px;
    text-align:center;
    position: relative;
    overflow:hidden;
  }
  .badgeBox::before{
    content:"";
    position:absolute; inset:-2px;
    background: linear-gradient(120deg, rgba(255,255,255,.10), transparent 40%, rgba(255,255,255,.08));
    opacity:.22;
    pointer-events:none;
    transform: translateX(-12%);
    animation: shimmer 3.6s ease-in-out infinite;
  }

  .badgeImg{
    width: 150px;
    height: 150px;
    object-fit: contain;
    filter: drop-shadow(0 18px 45px rgba(0,0,0,.75));
    margin-top: 6px;
    animation: badgePop .9s cubic-bezier(.12,.98,.18,1) .2s both;
  }
  .badgeLabel{
    margin-top: 12px;
    font-weight: 950;
    letter-spacing: .16em;
    text-transform: uppercase;
    font-size: 12px;
    color: rgba(255,255,255,.86);
  }
  .badgeType{
    margin-top: 6px;
    font-family:'Anton', sans-serif;
    font-size: 30px;
    letter-spacing: .08em;
    text-transform: uppercase;
    color: #fff;
    text-shadow: 0 18px 60px rgba(0,0,0,.85);
  }

  .summary{
    border-radius: 24px;
    border: 1px solid rgba(255,255,255,.12);
    background: rgba(0,0,0,.22);
    padding: 18px 18px 16px;
    box-shadow: 0 20px 70px rgba(0,0,0,.30);
    display:flex;
    flex-direction:column;
    gap: 12px;
  }

  .msg{
    font-weight: 950;
    font-size: 16px;
    color: rgba(255,255,255,.92);
    text-shadow: 0 18px 60px rgba(0,0,0,.85);
  }

  .stats{
    display:grid;
    grid-template-columns: 1fr 1fr;
    gap: 12px;
    margin-top: 2px;
  }
  .stat{
    border-radius: 18px;
    border: 1px solid rgba(255,255,255,.12);
    background: rgba(0,0,0,.18);
    padding: 12px 12px 10px;
  }
  .stat .k{
    font-size: 11px;
    font-weight: 950;
    letter-spacing: .16em;
    text-transform: uppercase;
    color: rgba(255,255,255,.72);
  }
  .stat .v{
    margin-top: 6px;
    font-family:'Anton', sans-serif;
    font-size: 22px;
    letter-spacing: .04em;
    color: rgba(255,255,255,.96);
  }

  .btnRow{
    position:absolute;
    left:50%;
    transform: translateX(-50%);
    bottom: 86px;
    z-index: 30;
    width: min(1500px, 92%);
    display:flex;
    gap: 12px;
    justify-content: center;
    flex-wrap: wrap;
    pointer-events:auto;
  }

  .btn-ember{
    border:0;
    border-radius:14px;
    padding:12px 18px;
    font-weight:950;
    font-size: 13px;
    letter-spacing:.10em;
    text-transform:uppercase;
    background: linear-gradient(180deg,#ffb05a,#ff7832);
    color:#0a0c12;
    box-shadow:0 14px 30px rgba(255,120,50,.22);
    transition: transform .15s ease, filter .15s ease;
    white-space: nowrap;
    cursor:pointer;
    user-select:none;
  }
  .btn-ember:hover{ transform: translateY(-2px); filter: brightness(1.06); }

  .btnGhost{
    border-radius:14px;
    padding:12px 18px;
    font-weight:950;
    font-size: 13px;
    letter-spacing:.10em;
    text-transform:uppercase;
    border: 1px solid rgba(140,200,255,.55);
    background: rgba(0,0,0,.28);
    color: rgba(255,255,255,.92);
    box-shadow: 0 16px 50px rgba(0,0,0,.30);
    transition: transform .15s ease, filter .15s ease;
    cursor:pointer;
    user-select:none;
  }
  .btnGhost:hover{ transform: translateY(-2px); filter: brightness(1.08); }

  /* ‚úÖ d√©sactivation visuelle (rejouer + retour accueil) */
  .btnGhost.is-disabled{
    opacity:.55;
    cursor:not-allowed;
    filter:saturate(.9);
  }
  .btnGhost.is-disabled:hover{
    transform:none;
    filter:saturate(.9);
  }

  .slogan{
    position:absolute;
    bottom: 24px;
    left:50%;
    transform: translateX(-50%);
    z-index: 30;
    width:min(1500px,92%);
    text-align:center;

    font-size:12px;
    font-weight:900;
    letter-spacing:.12em;
    text-transform:uppercase;
    color:rgba(255,255,255,.86);

    padding:10px 14px;
    border-radius:999px;
    background: rgba(0,0,0,.26);
    border:1px solid rgba(255,255,255,.14);
    backdrop-filter: blur(8px);
    box-shadow: 0 20px 60px rgba(0,0,0,.45);
    pointer-events:none;
  }

  /* =====================
     ‚úÖ MODAL BADGES (sur la m√™me page)
  ====================== */
  #badgesOverlay{
    position:absolute;
    inset:0;
    z-index: 120;
    display:none;
    align-items:center;
    justify-content:center;
    background: rgba(0,0,0,.55);
    backdrop-filter: blur(10px);
  }
  #badgesOverlay.is-on{ display:flex; }

  .boCard{
    width: min(1600px, 92%);
    height: min(860px, 86%);
    border-radius: 28px;
    background: rgba(0,0,0,.30);
    border: 1px solid rgba(255,255,255,.14);
    box-shadow: 0 26px 120px rgba(0,0,0,.75);
    overflow:hidden;
    position: relative;
    transform: translateY(8px) scale(.985);
    opacity:0;
    animation: cardIn .45s cubic-bezier(.2,.9,.2,1) .05s forwards;
  }
  @keyframes cardIn{
    to{ transform: translateY(0) scale(1); opacity:1; }
  }
  .boCard::before{
    content:"";
    position:absolute; inset:-2px;
    background:
      radial-gradient(900px 260px at 30% 0%, rgba(255,150,70,.14), transparent 60%),
      radial-gradient(900px 260px at 75% 120%, rgba(80,170,255,.10), transparent 60%);
    opacity:.9;
    pointer-events:none;
  }

  .boTop{
    position:relative;
    z-index:2;
    padding: 16px 18px;
    border-bottom: 1px solid rgba(255,255,255,.10);
    display:flex;
    align-items:flex-start;
    justify-content:space-between;
    gap: 12px;
    flex-wrap:wrap;
  }
  .boTitleWrap{
    min-width: 240px;
  }
  .boTitle{
    font-weight: 950;
    letter-spacing: .16em;
    text-transform: uppercase;
    font-size: 14px;
    color: rgba(255,255,255,.86);
    margin:0 0 6px;
  }
  .boHello{
    margin:0;
    font-weight: 950;
    font-size: 26px;
    text-shadow: 0 12px 30px rgba(0,0,0,.55);
  }
  .boHello .name{ color: rgba(255,190,110,1); text-shadow: 0 0 14px rgba(255,165,0,.35); }

  .closeX{
    width: 40px; height: 40px;
    border-radius: 14px;
    border: 1px solid rgba(255,255,255,.14);
    background: rgba(255,255,255,.06);
    color: rgba(255,255,255,.92);
    display:grid; place-items:center;
    font-weight: 950;
    cursor:pointer;
    user-select:none;
  }

  .pillRow{ display:flex; gap:10px; flex-wrap:wrap; margin-top: 10px; }
  .pill{
    padding: 7px 12px;
    border-radius: 999px;
    font-size: 12px;
    font-weight: 950;
    letter-spacing: .12em;
    text-transform: uppercase;
    border: 1px solid rgba(255,255,255,.18);
    background: rgba(0,0,0,.25);
    color: rgba(255,255,255,.88);
    white-space: nowrap;
    display:inline-flex;
    gap:8px;
    align-items:center;
  }
  .pillDot{ width:8px; height:8px; border-radius:999px; background: rgba(255,255,255,.35); }
  .pill.gold{ border-color: rgba(255,200,80,.28); }
  .pill.gold .pillDot{ background: rgba(255,200,80,.95); box-shadow: 0 0 0 5px rgba(255,200,80,.12); }
  .pill.silver{ border-color: rgba(160,210,255,.28); }
  .pill.silver .pillDot{ background: rgba(120,190,255,.95); box-shadow: 0 0 0 5px rgba(120,190,255,.12); }
  .pill.bronze{ border-color: rgba(255,150,70,.25); }
  .pill.bronze .pillDot{ background: rgba(255,150,70,.95); box-shadow: 0 0 0 5px rgba(255,150,70,.12); }

  .filterWrap{ display:flex; gap:10px; align-items:center; flex-wrap:wrap; justify-content:flex-end; }
  .filterBtn{
    border: 1px solid rgba(255,255,255,.18);
    background: rgba(0,0,0,.28);
    color: rgba(255,255,255,.92);
    border-radius: 999px;
    padding: 8px 12px;
    font-weight: 950;
    letter-spacing: .12em;
    text-transform: uppercase;
    font-size: 12px;
    cursor:pointer;
    transition: transform .15s ease, filter .15s ease, border-color .15s ease;
    user-select:none;
  }
  .filterBtn:hover{ transform: translateY(-1px); filter: brightness(1.06); }
  .filterBtn.active{
    border-color: rgba(255,165,0,.55);
    box-shadow: 0 0 0 4px rgba(255,165,0,.12);
  }

  .boBody{
    position:relative;
    z-index:2;
    padding: 14px 16px 12px;
    height: calc(100% - 92px);
    display:flex;
    flex-direction:column;
    gap: 12px;
  }
  .boHeadRow{
    display:flex;
    align-items:center;
    justify-content:space-between;
    gap:12px;
    flex-wrap:wrap;
    color: rgba(255,255,255,.76);
    font-weight: 900;
    font-size: 13px;
  }

  .listArea{
    flex: 1 1 auto;
    overflow:auto;
    padding: 6px 2px 2px;
  }

  .badgeRow{
    display:flex;
    align-items:center;
    justify-content:space-between;
    gap: 14px;
    padding: 12px 12px;
    border-radius: 18px;
    border: 1px solid rgba(255,255,255,.12);
    background: rgba(0,0,0,.22);
    box-shadow: 0 14px 40px rgba(0,0,0,.25);
    margin-bottom: 12px;
    opacity: 0;
    transform: translateY(10px);
    animation: rowIn .5s ease forwards;
  }
  @keyframes rowIn{ to{ opacity:1; transform: translateY(0); } }

  .bLeft{ display:flex; align-items:center; gap: 12px; min-width: 0; }
  .bThumb{
    width: 62px; height: 62px;
    border-radius: 18px;
    background: rgba(255,255,255,.06);
    border: 1px solid rgba(255,255,255,.14);
    display:grid;
    place-items:center;
    overflow:hidden;
    flex: 0 0 auto;
  }
  .bThumb img{ width: 44px; height: 44px; object-fit: contain; display:block; }
  .bText{ min-width: 0; }
  .bTitle{
    font-weight: 950;
    font-size: 16px;
    white-space: nowrap;
    overflow:hidden;
    text-overflow: ellipsis;
  }
  .bMeta{
    margin-top: 4px;
    color: rgba(255,255,255,.70);
    font-weight: 900;
    font-size: 12px;
    display:flex;
    gap: 10px;
    flex-wrap: wrap;
  }
  .chipMini{
    padding: 6px 10px;
    border-radius: 999px;
    font-size: 11px;
    font-weight: 950;
    letter-spacing: .10em;
    text-transform: uppercase;
    border: 1px solid rgba(255,255,255,.14);
    background: rgba(0,0,0,.22);
    white-space: nowrap;
  }
  .chipMini.gold{ border-color: rgba(255,200,80,.28); }
  .chipMini.silver{ border-color: rgba(120,190,255,.28); }
  .chipMini.bronze{ border-color: rgba(255,150,70,.25); }

  /* ANIMS existantes */
  @keyframes glowPulse{ 0%,100%{opacity:.78} 50%{opacity:1} }
  @keyframes fogMove{ 0%,100%{transform:translateX(-1%)} 50%{transform:translateX(2%)} }
  @keyframes grain{
    0%{ transform: translate(0,0); }
    25%{ transform: translate(-2%,1%); }
    50%{ transform: translate(1%,-2%); }
    75%{ transform: translate(-1%,-1%); }
    100%{ transform: translate(0,0); }
  }
  @keyframes lightning1{ 0%,78%{opacity:0} 80%{opacity:.95} 83%{opacity:.10} 86%{opacity:.65} 100%{opacity:0} }
  @keyframes lightning2{ 0%,64%{opacity:0} 66%{opacity:.90} 69%{opacity:.12} 72%{opacity:.62} 100%{opacity:0} }
  @keyframes thunderWave{
    0%,78%{ opacity:0; transform: translateX(-50%) scale(.92); }
    80%{ opacity:.85; transform: translateX(-50%) scale(1.02); }
    83%{ opacity:.12; transform: translateX(-50%) scale(.98); }
    86%{ opacity:.55; transform: translateX(-50%) scale(1.03); }
    100%{ opacity:0; transform: translateX(-50%) scale(1.00); }
  }
  @keyframes thunderFlash{ 0%,78%{ opacity:0; } 80%{ opacity:.92; } 82%{ opacity:.10; } 85%{ opacity:.68; } 100%{ opacity:0; } }

  @keyframes titleEnter{
    from{ opacity:0; transform: translateY(34px) scale(.96); filter: blur(12px); }
    to{ opacity:1; transform: translateY(0) scale(1); filter: blur(0px); }
  }
  @keyframes subtitleEnter{
    from{ opacity:0; transform: translateY(22px); filter: blur(10px); }
    to{ opacity:1; transform: translateY(0); filter: blur(0px); }
  }
  @keyframes fireGlow{ 0%,100%{ opacity:.55; transform: translateY(0);} 50%{ opacity:.95; transform: translateY(-6px);} }
  @keyframes embersRise{ 0%{ transform: translateY(12px); opacity:.20; } 30%{ opacity:.70; } 100%{ transform: translateY(-140px); opacity:0; } }
  @keyframes badgePop{
    from{ opacity:0; transform: translateY(10px) scale(.92); filter: blur(8px); }
    to{ opacity:1; transform: translateY(0) scale(1); filter: blur(0); }
  }
  @keyframes shimmer{
    0%,100%{ transform: translateX(-12%); opacity:.16; }
    50%{ transform: translateX(12%); opacity:.26; }
  }

  @media (prefers-reduced-motion: reduce){
    .glow,.fog,.lightning,.thunderWave,.thunderFlash,.grain,.fireGlow,.embers,
    .title,.subtitleBig,.badgeBox::before,.badgeImg,.badgeRow{ animation:none !important; }
  }
</style>
</head>

<body>
<div class="genially-stage">
  <div class="genially-page" id="geniallyPage">

    <main class="scene">

      <div class="grade" aria-hidden="true"></div>
      <div class="vignette" aria-hidden="true"></div>

      <div class="glow" aria-hidden="true"></div>
      <div class="fog" aria-hidden="true"></div>
      <div class="lightning flash1" aria-hidden="true"></div>
      <div class="lightning flash2" aria-hidden="true"></div>
      <div class="thunderWave" aria-hidden="true"></div>
      <div class="thunderFlash" aria-hidden="true"></div>
      <div class="grain" aria-hidden="true"></div>

      <div class="fireGlow" aria-hidden="true"></div>
      <div class="embers" aria-hidden="true"></div>

      <div class="missionPill" id="missionPill">FIN ‚Ä¢ R√âSULTATS</div>

      <section class="titleWrap" aria-label="Fin du jeu">
        <h1 class="title">URGENCES</h1>
        <div class="subtitleBig">FIN ‚Äî BADGE OBTENU</div>
      </section>

      <section class="endPanel" aria-label="R√©capitulatif">
        <div class="panelInner">
          <div class="endGrid">
            <div class="badgeBox">
              <img class="badgeImg" id="badgeImg" src="assets/bronze.png" alt="Badge">
              <div class="badgeLabel" id="badgeName">BADGE FINAL</div>
              <div class="badgeType" id="badgeType">BRONZE</div>
            </div>

            <div class="summary">
              <div class="msg" id="finalMsg">Mission termin√©e. R√©sultats enregistr√©s.</div>

              <div class="stats">
                <div class="stat">
                  <div class="k">JOUEUR</div>
                  <div class="v" id="playerOut">‚Äî</div>
                </div>
                <div class="stat">
                  <div class="k">NIVEAU</div>
                  <div class="v" id="levelOut">‚Äî</div>
                </div>
                <div class="stat">
                  <div class="k">SCORE GLOBAL</div>
                  <div class="v" id="scoreOut">0/100</div>
                </div>
                <div class="stat">
                  <div class="k">BADGES (SC√âNARIOS)</div>
                  <div class="v" id="missionsOut">0/4</div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>

      <div class="btnRow" aria-label="Actions fin de jeu">
        <button class="btn-ember" id="badgesBtn" type="button">VOIR MES BADGES</button>

        <!-- ‚úÖ plus de lien / pas de redirection -->
        <button class="btnGhost is-disabled" id="replayBtn" type="button" aria-disabled="true">REJOUER</button>
        <button class="btnGhost is-disabled" id="homeBtn" type="button" aria-disabled="true">RETOUR ACCUEIL</button>
      </div>

      <div class="slogan">BRAVO ‚Äî TU AS FAIT LA DIFF√âRENCE. CHAQUE SECONDE COMPTE.</div>

      <!-- ‚úÖ MODAL BADGES -->
      <div id="badgesOverlay" aria-hidden="true">
        <div class="boCard" role="dialog" aria-modal="true" aria-label="Badges obtenus">
          <div class="boTop">
            <div class="boTitleWrap">
              <div class="boTitle">COLLECTION</div>
              <p class="boHello" id="boHello">Bravo <span class="name">Joueur</span></p>
              <div class="pillRow">
                <span class="pill gold"><span class="pillDot"></span> OR <b id="cntOr">0</b></span>
                <span class="pill silver"><span class="pillDot"></span> ARGENT <b id="cntArgent">0</b></span>
                <span class="pill bronze"><span class="pillDot"></span> BRONZE <b id="cntBronze">0</b></span>
              </div>
            </div>

            <div style="display:flex; align-items:flex-start; gap:12px; flex-wrap:wrap; justify-content:flex-end;">
              <div class="filterWrap">
                <button class="filterBtn" data-filter="debutant">D√âBUTANT</button>
                <button class="filterBtn" data-filter="intermediaire">INTERM√âDIAIRE</button>
                <button class="filterBtn" data-filter="expert">EXPERT</button>
              </div>
              <div class="closeX" id="boClose">‚úï</div>
            </div>
          </div>

          <div class="boBody">
            <div class="boHeadRow">
              <div id="boTitleLine">BADGES ‚Äî NIVEAU : D√âBUTANT</div>
              <div id="boProgressLine">Badges obtenus : 0/4</div>
            </div>

            <div class="listArea" id="badgesList"></div>

            <div class="boHeadRow">
              <div>Filtre actif : <b id="boFilter">D√âBUTANT</b></div>
              <div>Score global estim√© : <b id="boScore">0/100</b></div>
            </div>
          </div>
        </div>
      </div>

    </main>
  </div>
</div>

<script>
/* =========================
   ‚úÖ SCALE AUTO (Genially)
========================= */
(function scaleGeniallyPage(){
  const page = document.getElementById('geniallyPage');
  function apply(){
    /* ‚úÖ ADAPTATION GENIALLY : 1980 x 1020 */
    const sw = window.innerWidth / 1980;
    const sh = window.innerHeight / 1020;
    const s = Math.min(sw, sh);
    page.style.transform = `scale(${s})`;
  }
  window.addEventListener('resize', apply);
  apply();
})();

/* =========================
   ‚úÖ AUDIO SFX (l√©ger)
========================= */
let audioCtx = null;
function ensureAudio(){ if(!audioCtx) audioCtx = new (window.AudioContext||window.webkitAudioContext)(); }
function tone(freq, dur=0.08, type="sine", gain=0.05){
  ensureAudio();
  const t0 = audioCtx.currentTime;
  const osc = audioCtx.createOscillator();
  const g = audioCtx.createGain();
  osc.type = type; osc.frequency.value = freq;
  g.gain.value = gain;
  osc.connect(g); g.connect(audioCtx.destination);
  osc.start(t0); osc.stop(t0 + dur);
}
function sfxClick(){ tone(520,0.04,"triangle",0.035); }
function sfxVictory(){
  const notes = [
    {f:659,d:0.10},{f:784,d:0.10},{f:988,d:0.14},
    {f:1175,d:0.18},{f:988,d:0.14},{f:1047,d:0.22}
  ];
  let t = 0;
  notes.forEach((n)=>{ setTimeout(()=>tone(n.f, n.d, "sine", 0.065), t*1000); t += n.d + 0.03; });
}

/* =========================
   ‚úÖ HELPERS
========================= */
const $ = (id)=>document.getElementById(id);
function escapeHtml(str){
  return String(str||"").replace(/[&<>"']/g,m=>({ "&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;","'":"&#039;" }[m]));
}
function normalizeDifficultyKey(d){
  const x = String(d||"").toLowerCase();
  if(x.includes("inter")) return "INTERMEDIAIRE";
  if(x.includes("expert")) return "EXPERT";
  return "DEBUTANT";
}
function prettyDifficulty(d){
  const k = normalizeDifficultyKey(d);
  if(k==="INTERMEDIAIRE") return "INTERM√âDIAIRE";
  if(k==="EXPERT") return "EXPERT";
  return "D√âBUTANT";
}
function badgeTypeFromAny(b){
  const t = (b?.type || b?.badgeType || b?.badgeLevel || "").toString().toUpperCase();
  if(t.includes("OR")) return "OR";
  if(t.includes("ARG")) return "ARGENT";
  return "BRONZE";
}
function badgeScoreFromAny(b){
  const v = (b?.score ?? b?.finalScore ?? 0);
  const n = parseInt(v,10);
  return isNaN(n) ? 0 : n;
}
function badgeMissionFromAny(b){
  return b?.mission || b?.scenarioMission || b?.label || b?.scenarioLabel || b?.name || "Mission";
}
function badgeDateFromTs(ts){
  if(!ts) return "";
  try{
    const d = new Date(ts);
    const pad=(x)=>String(x).padStart(2,"0");
    return `${pad(d.getDate())}/${pad(d.getMonth()+1)}/${d.getFullYear()} ‚Ä¢ ${pad(d.getHours())}:${pad(d.getMinutes())}`;
  }catch(e){ return ""; }
}

/* =========================
   ‚úÖ PROFIL
========================= */
const playerName =
  localStorage.getItem("player_name") ||
  localStorage.getItem("playerName") ||
  "Joueur";

const role = localStorage.getItem("role") || "";
const roleLabels = { medecin:"M√©decin", infirmier:"Infirmier", pompier:"Pompier" };

/* =========================
   ‚úÖ BADGES (lecture storage)
========================= */
const SCENARIOS = [
  { id: 1, label: "Sc√©nario 1" },
  { id: 2, label: "Sc√©nario 2" },
  { id: 3, label: "Sc√©nario 3" },
  { id: 4, label: "Sc√©nario 4" }
];

function readBadgeByScenarioAndDiff(scenarioId, diffKey){
  const keysToTry = [
    `badge_s${scenarioId}_${diffKey}`,
    `badge_s${scenarioId}_${prettyDifficulty(diffKey)}`,
    `badge_s${scenarioId}_${diffKey.toLowerCase()}`,
    `badge_s${scenarioId}`
  ];
  for(const k of keysToTry){
    const raw = localStorage.getItem(k);
    if(!raw) continue;
    try{
      const obj = JSON.parse(raw);
      if(obj && typeof obj==="object") return { key:k, obj };
    }catch(e){}
  }
  return null;
}

/* =========================
   ‚úÖ FIN: calcul score global + badge final
========================= */
function computeFinalBadge(score){
  if(score >= 90) return { type:"OR", img:"or.png" };
  if(score >= 70) return { type:"ARGENT", img:"argent.png" };
  return { type:"BRONZE", img:"bronze.png" };
}
function clamp(n,min,max){ return Math.max(min, Math.min(max, n)); }

function computeGlobalScoreFromScenarioBadges(diffKey){
  const scores = [];
  let got = 0;

  SCENARIOS.forEach(sc=>{
    const found = readBadgeByScenarioAndDiff(sc.id, diffKey);
    if(!found) return;
    got++;
    scores.push( clamp(badgeScoreFromAny(found.obj), 0, 100) );
  });

  if(scores.length){
    const avg = Math.round(scores.reduce((a,b)=>a+b,0) / scores.length);
    return { score: clamp(avg,0,100), got, total: SCENARIOS.length };
  }

  const fallback =
    parseInt(localStorage.getItem("score_total") || localStorage.getItem("score") || "0", 10) || 0;

  return { score: clamp(fallback,0,100), got: 0, total: SCENARIOS.length };
}

/* =========================
   ‚úÖ MODAL BADGES (r√©el)
========================= */
let activeFilterKey = normalizeDifficultyKey(
  localStorage.getItem("badges_filter") ||
  localStorage.getItem("niveau") ||
  localStorage.getItem("difficulty") ||
  "debutant"
);

const filterBtns = document.querySelectorAll(".filterBtn");
filterBtns.forEach(btn=>{
  btn.addEventListener("click", ()=>{
    sfxClick();
    activeFilterKey = normalizeDifficultyKey(btn.dataset.filter);
    localStorage.setItem("badges_filter", activeFilterKey);
    refreshBadgesModal();
  });
});

function setActiveFilterUI(){
  filterBtns.forEach(b=>{
    b.classList.toggle("active", normalizeDifficultyKey(b.dataset.filter) === activeFilterKey);
  });
  $("boTitleLine").textContent = `BADGES ‚Äî NIVEAU : ${prettyDifficulty(activeFilterKey)}`;
  $("boFilter").textContent = prettyDifficulty(activeFilterKey);
}

function renderList(){
  const host = $("badgesList");
  host.innerHTML = "";

  let got = 0;
  let cntOR = 0, cntARG = 0, cntBR = 0;

  const items = [];

  SCENARIOS.forEach(sc=>{
    const found = readBadgeByScenarioAndDiff(sc.id, activeFilterKey);
    if(!found) return;

    const b = found.obj;
    const type = badgeTypeFromAny(b);
    if(type==="OR") cntOR++;
    else if(type==="ARGENT") cntARG++;
    else cntBR++;

    got++;

    items.push({
      scenarioId: sc.id,
      scenarioLabel: sc.label,
      type,
      img: (b?.img || b?.badgeImage || b?.image || ""),
      mission: badgeMissionFromAny(b),
      score: badgeScoreFromAny(b),
      ts: badgeDateFromTs(b?.ts)
    });
  });

  $("cntOr").textContent = String(cntOR);
  $("cntArgent").textContent = String(cntARG);
  $("cntBronze").textContent = String(cntBR);

  $("boProgressLine").textContent = `Badges obtenus : ${got}/4`;

  const gs = computeGlobalScoreFromScenarioBadges(activeFilterKey);
  $("boScore").textContent = `${gs.score}/100`;

  if(items.length === 0){
    host.innerHTML = `
      <div style="padding:18px; border:1px dashed rgba(255,255,255,.18); border-radius:18px; background: rgba(0,0,0,.18);">
        <div style="font-weight:950; font-size:16px;">Aucun badge obtenu sur ce niveau.</div>
        <div style="margin-top:6px; color: rgba(255,255,255,.72); font-weight:900; font-size:13px;">
          Termine un sc√©nario puis reviens ici.
        </div>
      </div>
    `;
    return;
  }

  items.forEach((it, index)=>{
    const chipClass = (it.type==="OR") ? "gold" : (it.type==="ARGENT") ? "silver" : "bronze";
    const imgSrc = it.img ? `assets/${escapeHtml(it.img)}` : "assets/bronze.png";
    const delay = 70 * index;

    const row = document.createElement("div");
    row.className = "badgeRow";
    row.style.animationDelay = `${delay}ms`;
    row.innerHTML = `
      <div class="bLeft">
        <div class="bThumb"><img src="${imgSrc}" alt="badge"></div>
        <div class="bText">
          <div class="bTitle">üèÖ ${escapeHtml(it.scenarioLabel)} ‚Äî ${escapeHtml(it.mission)}</div>
          <div class="bMeta">
            <span class="chipMini ${chipClass}">${escapeHtml(prettyDifficulty(activeFilterKey))}</span>
            <span class="chipMini ${chipClass}">${escapeHtml(it.type)}</span>
            <span class="chipMini">‚≠ê ${escapeHtml(String(it.score))}</span>
            ${it.ts ? `<span class="chipMini">üïí ${escapeHtml(it.ts)}</span>` : ``}
          </div>
        </div>
      </div>
      <div></div>
    `;
    host.appendChild(row);
  });
}

function refreshBadgesModal(){
  $("boHello").innerHTML = `Bravo <span class="name">${escapeHtml(playerName)}</span> ‚Äî voici tes badges.`;
  setActiveFilterUI();
  renderList();
}

function openBadgesModal(){
  refreshBadgesModal();
  $("badgesOverlay").classList.add("is-on");
  $("badgesOverlay").setAttribute("aria-hidden","false");
}
function closeBadgesModal(){
  $("badgesOverlay").classList.remove("is-on");
  $("badgesOverlay").setAttribute("aria-hidden","true");
}

/* =========================
   ‚úÖ INIT FIN (page)
========================= */
(function initEnd(){
  const lvlPretty = prettyDifficulty(activeFilterKey);
  const rolePretty = roleLabels[role] ? ` ‚Ä¢ M√©tier : ${roleLabels[role]}` : "";
  const { score, got, total } = computeGlobalScoreFromScenarioBadges(activeFilterKey);

  const final = computeFinalBadge(score);

  $("playerOut").textContent = `Dr. ${playerName}${rolePretty}`;
  $("levelOut").textContent = lvlPretty;
  $("scoreOut").textContent = `${score}/100`;
  $("missionsOut").textContent = `${got}/${total}`;

  $("badgeImg").src = `assets/${final.img}`;
  $("badgeType").textContent = final.type;

  const msg = (final.type === "OR")
    ? `Performance exceptionnelle, ${playerName}. Tu es pr√™t(e) √† sauver des vies.`
    : (final.type === "ARGENT")
      ? `Tr√®s bon travail, ${playerName}. Tu gagnes en ma√Ætrise.`
      : `Bravo, ${playerName}. Continue √† t‚Äôentra√Æner : chaque seconde compte.`;
  $("finalMsg").textContent = msg;

  const key = `badge_game_end_${activeFilterKey}`;
  localStorage.setItem(key, JSON.stringify({
    scenario: "FIN",
    scenarioId: "FIN",
    mission: "Fin de jeu",
    niveau: lvlPretty,
    score: score,
    type: final.type,
    img: final.img,
    ts: new Date().toISOString(),
    player: playerName
  }));
  localStorage.setItem("last_badge_key", key);

  sfxVictory();
})();

/* =========================
   ‚úÖ EVENTS (boutons)
========================= */
$("badgesBtn").addEventListener("click", ()=>{
  sfxClick();
  openBadgesModal();
});

$("boClose").addEventListener("click", ()=>{ sfxClick(); closeBadgesModal(); });

$("badgesOverlay").addEventListener("click", (e)=>{
  if(e.target === $("badgesOverlay")){
    sfxClick();
    closeBadgesModal();
  }
});

$("replayBtn").addEventListener("click", ()=>{ sfxClick(); });
$("homeBtn").addEventListener("click", ()=>{ sfxClick(); });
</script>

</body>
</html>
