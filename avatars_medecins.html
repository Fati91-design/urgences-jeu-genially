<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Urgences – Avatar Médecins</title>

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

  <style>
    html, body { background: transparent; margin: 0; color: #fff; }

    /* ✅ Genially: scène fixe 16:9 + scale auto */
    .genially-stage{
      width: 100vw;
      height: 100vh;
      display:flex;
      align-items:center;
      justify-content:center;
      overflow:hidden;
    }
    .genially-page{
      width: 1920px;
      height: 1080px;
      position: relative;
      transform-origin: center;
    }

    .page-wrap{
      position:absolute;
      inset:0;
      display:flex;
      align-items:center;
      justify-content:center;
      padding: 44px 52px; /* ✅ ajusté Genially */
    }

    .glass{
      width: 1260px;                 /* ✅ fixe pour Genially */
      max-width: 1260px;
      background: rgba(0,0,0,.42);
      border: 1px solid rgba(255,255,255,.14);
      backdrop-filter: blur(10px);
      border-radius: 22px;
      box-shadow: 0 18px 50px rgba(0,0,0,.35);
      overflow: hidden;
      position: relative;
    }

    #fx{
      position:absolute;
      inset:0;
      width:100%;
      height:100%;
      pointer-events:none;
      opacity:.85;
      mix-blend-mode:screen;
      z-index:1;
    }

    .header{
      padding: 20px 22px 14px;
      border-bottom:1px solid rgba(255,255,255,.1);
      position:relative;
      z-index:2;
    }

    .hello{
      margin:0 0 8px;
      font-weight:900;
      font-size: 34px;              /* ✅ lisible en 1920 */
      text-shadow:0 12px 30px rgba(0,0,0,.55);
    }

    .hello .name{
      color:rgba(255,190,110,1);
      text-shadow:0 0 18px rgba(255,165,0,.35);
    }

    .subtitle{
      margin:0;
      font-size:15px;
      color:rgba(255,255,255,.74);
    }

    .trio-wrap{
      padding: 18px 22px 22px;
      display:flex;
      justify-content:center;
      z-index:2;
      position:relative;
    }

    .trio{
      width: 1160px;                /* ✅ fixe pour Genially */
      height: 520px;                /* ✅ plus haut pour loger 2 boutons */
      position:relative;
      display:flex;
      justify-content:center;
      align-items:flex-end;
    }

    .avatar-block{
      position:absolute;
      bottom: 0;
      width: 340px;                 /* ✅ plus large */
      display:flex;
      flex-direction:column;
      align-items:center;
      gap: 12px;
    }

    .avatar-pick{
      height: 380px;                /* ✅ plus grand */
      user-select:none;
      --sx:1; --ty:0px;
      transform: translateY(var(--ty)) scale(var(--sx));
      transform-origin:bottom center;
      filter:drop-shadow(0 18px 18px rgba(0,0,0,.45));
      transition:transform .16s ease, filter .16s ease, opacity .16s ease;
      opacity:.98;
      pointer-events:none; /* sélection via boutons */
    }

    .left{left:0%;--sx:.96}
    .center{left:50%;transform:translateX(-50%);--sx:1.03;z-index:3}
    .right{right:0%;--sx:.96}

    .selected{
      --ty:-10px;
      filter:drop-shadow(0 26px 28px rgba(0,0,0,.65))
             drop-shadow(0 0 18px rgba(255,165,0,.55));
      z-index:6;
      opacity:1;
    }

    .dimmed{opacity:.55}

    .footer{
      padding: 14px 22px 18px;
      border-top:1px solid rgba(255,255,255,.1);
      display:flex;
      justify-content:center;
      align-items:center;
      z-index:2;
      position:relative;
      text-align:center;
    }

    .helpTxt{
      font-size:14px;
      color:rgba(255,255,255,.72);
    }

    /* ✅ Boutons Genially (mêmes dimensions que la page infirmier) */
    .btn-row{
      display:flex;
      gap: 12px;
      align-items:center;
      justify-content:center;
    }

    .btn-ember{
      border:0;
      border-radius:16px;
      padding: 12px 20px;
      font-weight:900;
      letter-spacing:.10em;
      text-transform:uppercase;
      font-size: 14px;
      background:linear-gradient(180deg,#ffb05a,#ff7832);
      color:#0a0c12;
      box-shadow:0 16px 35px rgba(255,120,50,.22);
      transition: transform .15s ease, filter .15s ease;
      min-width: 160px;
    }
    .btn-ember:hover{ transform: translateY(-2px); filter: brightness(1.06); }

    .btn-next{
      border-radius:16px;
      padding: 12px 20px;
      font-weight:900;
      letter-spacing:.10em;
      text-transform:uppercase;
      font-size: 14px;
      border: 1px solid rgba(140,200,255,.55);
      background: rgba(0,0,0,.22);
      color: rgba(255,255,255,.92);
      box-shadow: 0 16px 35px rgba(0,0,0,.22);
      transition: transform .15s ease, filter .15s ease;
      min-width: 160px;
    }
    .btn-next:hover{ transform: translateY(-2px); filter: brightness(1.08); }
    .btn-next:disabled{
      opacity:.45;
      cursor:not-allowed;
      transform:none;
      filter:none;
    }
  </style>
</head>

<body>
<div class="genially-stage">
  <div class="genially-page" id="geniallyPage">
    <div class="page-wrap">
      <div class="glass">
        <canvas id="fx"></canvas>

        <div class="header">
          <p class="hello" id="helloLine"></p>
          <p class="subtitle">Métier : Médecins — enregistre l’avatar puis clique sur “Suivant”.</p>
        </div>

        <div class="trio-wrap">
          <div class="trio" id="trio"></div>
        </div>

        <div class="footer">
          <div class="helpTxt" id="helpTxt">Choisis un avatar, puis clique sur “Enregistrer”.</div>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
  /* ✅ Scale auto pour Genially */
  (function scaleGeniallyPage(){
    const page = document.getElementById('geniallyPage');
    function apply(){
      const sw = window.innerWidth / 1920;
      const sh = window.innerHeight / 1080;
      const s = Math.min(sw, sh);
      page.style.transform = `scale(${s})`;
    }
    window.addEventListener('resize', apply);
    apply();
  })();

  const ROLE = "medecin";

  const playerName = localStorage.getItem("player_name") || localStorage.getItem("playerName") || "Joueur";
  document.getElementById("helloLine").innerHTML =
    `Bonjour <span class="name">${escapeHtml(playerName)}</span>, choisis ton avatar.`;

  const avatars = [
    {pos:"left",  file:"medecin_f.png",        label:"Médecin (F)"},
    {pos:"center",file:"medecin_f_voilee.png", label:"Médecin (F voilée)"},
    {pos:"right", file:"medecin_h.png",        label:"Médecin (H)"},
  ];

  const trio = document.getElementById("trio");
  const helpTxt = document.getElementById("helpTxt");

  let selectedFile = null;

  function render(){
    trio.innerHTML = "";
    avatars.forEach(a=>{
      const wrap = document.createElement("div");
      wrap.className = `avatar-block ${a.pos}`;
      wrap.dataset.file = a.file;

      const img = document.createElement("img");
      img.src = `assets/avatars/${a.file}`;
      img.className = `avatar-pick`;
      img.alt = a.label;

      /* ✅ 2 boutons sous chaque avatar (comme infirmier) */
      const btnRow = document.createElement("div");
      btnRow.className = "btn-row";

      const saveBtn = document.createElement("button");
      saveBtn.type = "button";
      saveBtn.className = "btn-ember";
      saveBtn.textContent = "ENREGISTRER";
      saveBtn.onclick = (e)=>{ e.stopPropagation(); saveAvatar(a.file); };

      const nextBtn = document.createElement("button");
      nextBtn.type = "button";
      nextBtn.className = "btn-next";
      nextBtn.textContent = "SUIVANT";
      nextBtn.disabled = true;
      nextBtn.onclick = (e)=>{ e.stopPropagation(); goNext(); };

      btnRow.appendChild(saveBtn);
      btnRow.appendChild(nextBtn);

      wrap.appendChild(img);
      wrap.appendChild(btnRow);
      trio.appendChild(wrap);
    });

    if (selectedFile) markSelected(selectedFile);
  }

  function markSelected(file){
    selectedFile = file;

    document.querySelectorAll(".avatar-block").forEach(b=>{
      const isSel = b.dataset.file === file;

      b.classList.toggle("selected", isSel);
      b.classList.toggle("dimmed", !isSel);

      const img = b.querySelector(".avatar-pick");
      img.classList.toggle("selected", isSel);
      img.classList.toggle("dimmed", !isSel);

      const nextBtn = b.querySelector(".btn-next");
      if (nextBtn) nextBtn.disabled = !isSel;
    });
  }

  function saveAvatar(file){
    markSelected(file);
    localStorage.setItem("role", ROLE);
    localStorage.setItem("avatar", file);
    helpTxt.textContent = "✅ Avatar enregistré. Le bouton “Suivant” est activé.";
  }

  function goNext(){
    if(!selectedFile) return;
    // volontairement vide (pas de redirection)
    helpTxt.textContent = "➡️ Prêt ! Continue dans Genially.";
  }

  function escapeHtml(str){
    return String(str).replace(/[&<>"']/g,m=>({
      "&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;","'":"&#039;"
    }[m]));
  }

  render();
</script>
</body>
</html>
