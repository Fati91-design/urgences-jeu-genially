<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Sc√©nario ‚Äî √âtouffement</title>

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

  <style>
    :root{
      --glass: rgba(25, 27, 31, .72);
      --glass2: rgba(15, 17, 20, .55);
      --stroke: rgba(255, 200, 150, .22);
      --strokeW: rgba(255,255,255,.10);

      --text: rgba(255,255,255,.93);
      --muted: rgba(255,255,255,.70);

      --gold: rgba(255,200,80,1);
      --red: rgba(255,70,70,1);
      --green: rgba(45,200,120,1);
      --blue: rgba(80,170,255,1);
      --ember: rgba(255,150,70,1);
    }

    html,body{ margin:0; background:transparent; color:var(--text); font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif; }

    /* ‚úÖ pas de grand conteneur g√©n√©ral */
    .stage{
      min-height: 100vh;
      padding: 18px;
      display:flex;
      justify-content:center;
      align-items:flex-start;
      background: transparent;
    }
    .wrap{ width:min(1120px, 100%); }

    /* ‚úÖ HUD en 2 blocs s√©par√©s (sans wrapper g√©ant) */
    .hud{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 18px;
      margin-bottom: 18px;
    }

    .hudbox{
      background: var(--glass);
      border: 1px solid var(--stroke);
      border-radius: 18px;
      padding: 14px 16px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 14px;
      position: relative;
      overflow:hidden;
      box-shadow: 0 18px 65px rgba(0,0,0,.45);
      backdrop-filter: blur(12px);
    }
    .hudbox::after{
      content:"";
      position:absolute; inset:-2px;
      background:
        radial-gradient(420px 160px at 15% 0%, rgba(255,150,70,.18), transparent 60%),
        radial-gradient(520px 220px at 85% 120%, rgba(80,170,255,.10), transparent 60%);
      opacity:.9;
      pointer-events:none;
    }

    /* Profil */
    .profile{ display:flex; align-items:center; gap:14px; min-width:0; z-index:2; }
    .avatarFrame{
      width: 92px; height: 92px;
      border-radius: 24px; padding:4px;
      background: linear-gradient(180deg, rgba(255,150,70,.36), rgba(80,170,255,.14));
      box-shadow: 0 18px 42px rgba(0,0,0,.45);
      flex:0 0 auto;
    }
    .avatar{
      width:100%; height:100%;
      border-radius: 20px;
      border: 1px solid rgba(255,255,255,.12);
      object-fit: cover;

      /* ‚úÖ zoom visage */
      object-position: 50% 6%;
      transform: scale(1.35);
      transform-origin: 50% 12%;
      background: rgba(255,255,255,.06);
    }
    .ptext{ min-width:0; }
    .pname{
      font-weight: 950;
      font-size: 22px;
      line-height: 1.05;
      white-space: nowrap; overflow:hidden; text-overflow: ellipsis;
      text-shadow: 0 14px 30px rgba(0,0,0,.55);
    }
    .prole{
      margin-top:4px;
      font-weight: 850;
      font-size: 13px;
      color: var(--muted);
      white-space: nowrap; overflow:hidden; text-overflow: ellipsis;
    }
    .chip{
      background: rgba(255,150,70,.14);
      border: 1px solid rgba(255,150,70,.20);
      border-radius: 999px;
      padding: 9px 12px;
      font-size: 12px;
      font-weight: 950;
      white-space: nowrap;
      z-index:2;
    }

    /* Stats */
    .stats{ display:flex; align-items:center; justify-content:flex-end; gap:12px; flex-wrap:wrap; z-index:2; }
    .pill{
      display:flex; align-items:center; gap:10px;
      padding: 10px 12px;
      border-radius: 999px;
      background: rgba(255,255,255,.06);
      border: 1px solid rgba(255,255,255,.10);
      font-weight: 950; font-size: 13px;
      white-space: nowrap;
    }

    /* ‚úÖ Timer am√©lior√© */
    .timerPill{
      padding: 8px 10px;
      gap: 10px;
      border: 1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.18);
    }
    .ring{
      width: 40px; height: 40px; border-radius: 999px;
      background: conic-gradient(var(--gold) var(--p, 0%), rgba(255,255,255,.14) 0);
      display:grid; place-items:center;
      box-shadow: 0 0 0 5px rgba(255,200,80,.14), 0 0 28px rgba(255,200,80,.10);
      transition: box-shadow .2s ease;
    }
    .ringInner{
      width: 28px; height: 28px; border-radius: 999px;
      background: rgba(0,0,0,.35);
      border: 1px solid rgba(255,255,255,.12);
      display:grid; place-items:center;
      font-size: 14px; font-weight: 950;
    }
    .timeText{ display:flex; align-items:center; gap:8px; }
    .timeText .label{ font-size:12px; font-weight:900; color: rgba(255,255,255,.75); }
    .timeText .sec{ font-size:16px; font-weight:950; }

    .timerWarn .ring{ box-shadow: 0 0 0 5px rgba(255,200,80,.18), 0 0 32px rgba(255,200,80,.14); }
    .timerDanger .ring{
      background: conic-gradient(var(--red) var(--p, 0%), rgba(255,255,255,.14) 0);
      box-shadow: 0 0 0 5px rgba(255,70,70,.20), 0 0 40px rgba(255,70,70,.18);
    }

    .stressWrap{
      width: 240px; height: 12px; border-radius: 999px;
      background: rgba(255,255,255,.10);
      border: 1px solid rgba(255,255,255,.10);
      overflow:hidden;
    }
    .stressBar{
      height:100%; width:0%;
      background: linear-gradient(90deg, rgba(45,200,120,.95), rgba(255,200,80,.95), rgba(255,70,70,.95));
      transition: width .25s ease;
    }

    /* Questions */
    .frame{
      background: var(--glass2);
      border: 1px solid var(--stroke);
      border-radius: 18px;
      padding: 18px;
      position: relative;
      overflow:hidden;
      box-shadow: 0 18px 70px rgba(0,0,0,.50);
      backdrop-filter: blur(12px);
    }
    .frame::after{
      content:"";
      position:absolute; inset:-2px;
      background:
        radial-gradient(800px 260px at 55% 0%, rgba(255,150,70,.16), transparent 60%),
        radial-gradient(760px 260px at 40% 120%, rgba(80,170,255,.10), transparent 60%);
      opacity:.9;
      pointer-events:none;
    }
    .qmeta{ position:relative; z-index:2; color: rgba(255,255,255,.70); font-size:12px; font-weight:950; letter-spacing:.35px; text-transform:uppercase; }
    .qtitle{ position:relative; z-index:2; margin-top:6px; font-weight:950; font-size: clamp(18px, 2.2vw, 26px); line-height:1.2; text-shadow: 0 14px 30px rgba(0,0,0,.55); }
    .qdesc{ position:relative; z-index:2; margin-top:10px; color: rgba(255,255,255,.82); font-size:14px; line-height:1.5; max-width:980px; }
    .options{ position:relative; z-index:2; display:flex; flex-direction:column; gap:12px; margin-top:16px; }
    .opt{
      border-radius: 14px;
      padding: 13px 14px;
      font-weight: 950;
      cursor:pointer; user-select:none;
      transition: transform .12s ease, filter .12s ease, background .12s ease;
      border: 1px solid rgba(255,255,255,.12);
      background: linear-gradient(180deg, rgba(80,170,255,.22), rgba(80,170,255,.14));
      box-shadow: 0 10px 28px rgba(0,0,0,.20);
    }
    .opt:hover{ transform: translateY(-1px); filter: brightness(1.07); background: linear-gradient(180deg, rgba(255,150,70,.22), rgba(80,170,255,.10)); }

    /* Overlays */
    .overlay{
      position: fixed; inset: 0;
      display:none;
      align-items:center; justify-content:center;
      z-index: 50;
      background: rgba(0,0,0,.48);
      backdrop-filter: blur(8px);
    }
    .modalBox{
      width: min(760px, 92%);
      border-radius: 18px;
      border: 1px solid rgba(255,255,255,.12);
      background: rgba(8,10,14,.82);
      box-shadow: 0 26px 90px rgba(0,0,0,.62);
      overflow:hidden;
    }
    .modalTop{
      padding: 14px 16px;
      border-bottom: 1px solid rgba(255,255,255,.10);
      display:flex; align-items:center; justify-content:space-between; gap:10px;
    }
    .badgeState{
      font-weight: 950;
      border-radius: 999px;
      padding: 7px 10px;
      font-size: 12px;
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.06);
      white-space: nowrap;
    }
    .bWarn{ border-color: rgba(255,200,80,.30); background: rgba(255,200,80,.12); }
    .modalBody{ padding: 16px; color: rgba(255,255,255,.92); line-height: 1.5; font-size: 14px; }
    .modalActions{
      padding: 14px 16px;
      border-top: 1px solid rgba(255,255,255,.10);
      display:flex; justify-content:flex-end; gap:10px; flex-wrap:wrap;
    }
    .startBtn{
      border:none; border-radius: 14px;
      padding: 12px 16px;
      font-weight: 950;
      background: linear-gradient(180deg, rgba(255,176,90,1), rgba(255,120,50,1));
      color: rgba(10,12,18,.96);
      box-shadow: 0 18px 50px rgba(0,0,0,.35);
    }

    .alarmGlow{ animation: alarmGlow 1.2s ease-in-out infinite; }
    @keyframes alarmGlow{ 0%{transform:scale(1)} 50%{transform:scale(1.02)} 100%{transform:scale(1)} }

    @media (max-width: 860px){
      .hud{ grid-template-columns: 1fr; }
      .stressWrap{ width: 190px; }
    }
  </style>
</head>

<body>
<div class="stage">
  <div class="wrap">

    <!-- ‚úÖ HUD: deux blocs s√©par√©s -->
    <div class="hud">
      <!-- Profil -->
      <div class="hudbox">
        <div class="profile">
          <div class="avatarFrame">
            <img class="avatar" id="hudAvatar" alt="Avatar">
          </div>
          <div class="ptext">
            <div class="pname" id="hudName">Joueur</div>
            <div class="prole" id="hudRole">R√¥le: ‚Äî</div>
          </div>
        </div>
        <div class="chip" id="difficultyChip">MODE: NORMAL</div>
      </div>

      <!-- Stats -->
      <div class="hudbox">
        <div class="stats">
          <div class="pill">‚≠ê <span id="hudScore">0</span></div>
          <div class="pill">Q <span id="hudQnum">1</span>/<span id="hudQtotal">10</span></div>

          <div class="pill timerPill" id="timerPill">
            <div class="ring" id="ring"><div class="ringInner">‚è±</div></div>
            <div class="timeText">
              <div class="label">Temps</div>
              <div class="sec"><span id="hudTime">12</span>s</div>
            </div>
          </div>

          <div class="stressWrap" title="Stress">
            <div class="stressBar" id="stressBar"></div>
          </div>
        </div>
      </div>
    </div>

    <!-- Questions -->
    <div class="frame" id="frame">
      <div class="qmeta">Sc√©nario 1 ‚Äî √âtouffement</div>
      <div class="qtitle" id="qTitle">Pr√©pare-toi‚Ä¶</div>
      <div class="qdesc" id="qDesc">Clique sur <b>D√âMARRER</b> pour lancer le sc√©nario (le timer commencera).</div>
      <div class="options" id="options"></div>
    </div>

  </div>
</div>

<!-- ‚úÖ START overlay -->
<div class="overlay" id="startOverlay" style="display:flex;">
  <div class="modalBox">
    <div class="modalTop">
      <div class="badgeState bWarn">üéÆ Pr√™t ?</div>
      <div style="color: rgba(255,255,255,.75); font-size:12px; font-weight:950;">
        Sc√©nario 1 ‚Ä¢ √âtouffement
      </div>
    </div>
    <div class="modalBody">
      <div style="font-weight:950; font-size:22px; margin-bottom:6px;">Tu vas intervenir en situation r√©elle.</div>
      <div style="color: rgba(255,255,255,.82); font-size:14px; line-height:1.45;">
        Tu as peu de temps pour d√©cider. Lis bien, choisis vite, et √©vite les erreurs critiques.
        <br><br><b>Es-tu pr√™t √† commencer ?</b>
      </div>
    </div>
    <div class="modalActions">
      <button class="startBtn" id="startBtn">D√âMARRER</button>
    </div>
  </div>
</div>

<script>
/* ===== AUDIO (alarme longue) ===== */
let audioCtx=null;
function ensureAudio(){ if(!audioCtx) audioCtx = new (window.AudioContext||window.webkitAudioContext)(); }
function sfxAlarmLong(){
  ensureAudio();
  const now = audioCtx.currentTime;
  const osc = audioCtx.createOscillator();
  const g = audioCtx.createGain();
  osc.type = "sawtooth";
  osc.frequency.setValueAtTime(520, now);
  osc.frequency.linearRampToValueAtTime(380, now + 0.35);
  osc.frequency.linearRampToValueAtTime(520, now + 0.70);
  g.gain.setValueAtTime(0.0001, now);
  g.gain.exponentialRampToValueAtTime(0.07, now + 0.02);
  g.gain.exponentialRampToValueAtTime(0.001, now + 1.10);
  osc.connect(g); g.connect(audioCtx.destination);
  osc.start(now);
  osc.stop(now + 1.2);
}

/* ===== CONTEXTE JOUEUR ===== */
const role = localStorage.getItem("role") || "infirmier";
const playerName = localStorage.getItem("playerName") || "Joueur";
const avatarFile = localStorage.getItem("avatar") || "medecin_f.png";
const difficulty = (localStorage.getItem("difficulty") || "normal").toLowerCase();

const roleLabelMap = { medecin:"M√©decin", infirmier:"Infirmier", pompier:"Pompier" };
document.getElementById("hudName").textContent = playerName;
document.getElementById("hudRole").textContent = "R√¥le: " + (roleLabelMap[role] || "‚Äî");
document.getElementById("hudAvatar").src = "assets/avatars/" + avatarFile;

const cfg = { time: 12 };
document.getElementById("difficultyChip").textContent = "MODE: " + difficulty.toUpperCase();

/* ===== HUD ===== */
let score = parseInt(localStorage.getItem("score") || "0", 10); if(isNaN(score)) score=0;
let stress = parseInt(localStorage.getItem("stress") || "0", 10); if(isNaN(stress)) stress=0;
document.getElementById("hudScore").textContent = score;
document.getElementById("hudQtotal").textContent = "10";
document.getElementById("stressBar").style.width = Math.max(0,Math.min(100,stress)) + "%";

/* ===== TIMER UI ===== */
let locked = true; // ‚úÖ bloqu√© avant d√©marrer
let timeLeft = cfg.time;
let timerId = null;

const hudTime = document.getElementById("hudTime");
const ring = document.getElementById("ring");
const timerPill = document.getElementById("timerPill");

function setRingProgress(){
  const p = Math.max(0, Math.min(100, Math.round((timeLeft / cfg.time) * 100)));
  ring.style.setProperty("--p", p + "%");

  timerPill.classList.remove("timerWarn","timerDanger","alarmGlow");
  if(timeLeft <= 4) timerPill.classList.add("timerDanger");
  else if(timeLeft <= 7) timerPill.classList.add("timerWarn");
}

function startTimer(){
  clearInterval(timerId);
  timeLeft = cfg.time;
  hudTime.textContent = String(timeLeft);
  setRingProgress();

  timerId = setInterval(()=>{
    if(locked) return;
    timeLeft--;
    hudTime.textContent = String(timeLeft);
    setRingProgress();

    if(timeLeft <= 0){
      clearInterval(timerId);
      sfxAlarmLong();
      timerPill.classList.add("alarmGlow");
      // ici tu peux d√©clencher ton overlay de feedback si tu veux
    }
  }, 1000);
}

/* ===== DEMARRER ===== */
document.getElementById("startBtn").addEventListener("click", ()=>{
  ensureAudio();
  document.getElementById("startOverlay").style.display = "none";
  locked = false;
  startTimer();

  // Exemple : charger Q1 (tu peux remettre ta logique compl√®te ici)
  document.getElementById("qTitle").textContent = "Reconna√Ætre l‚Äôobstruction s√©v√®re";
  document.getElementById("qDesc").textContent = "La victime ne peut pas parler et sa toux est faible. Quelle conclusion ?";
  document.getElementById("options").innerHTML = `
    <div class="opt">Obstruction l√©g√®re (encourager la toux)</div>
    <div class="opt">Obstruction s√©v√®re des voies a√©riennes</div>
    <div class="opt">Crise d‚Äôangoisse uniquement</div>
  `;
});

/* Init preview */
hudTime.textContent = String(cfg.time);
ring.style.setProperty("--p", "100%");
</script>

</body>
</html>
