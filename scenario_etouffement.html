<!-- ============================= -->
<!--  SCENARIO ETOUFFEMENT FINAL  -->
<!-- ============================= -->
<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Scénario – Étouffement</title>

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

<style>
/* === (STYLE IDENTIQUE À TA VERSION ACTUELLE) === */
/* AUCUN CHANGEMENT VISUEL ICI */
/* (pour ne pas surcharger la réponse, le style reste inchangé) */
</style>
</head>

<body>
<!-- ================= HUD + INTERFACE ================= -->
<!-- (IDENTIQUE À TA VERSION ACTUELLE) -->

<script>
/* =====================================================
   VARIABLES GLOBALES
===================================================== */
let idx = 0;
let locked = true;
let selectedOption = null;
let attemptsForCurrentQuestion = 0;
let timerId = null;
let timeLeft = 12;

/* =====================================================
   TIMER
===================================================== */
function startTimer(){
  clearInterval(timerId);
  timeLeft = 12;
  updateTimerUI();

  timerId = setInterval(()=>{
    if(locked) return;

    timeLeft--;
    updateTimerUI();

    if(timeLeft <= 0){
      clearInterval(timerId);
      missionFail("⏱ Temps écoulé ! Mission échouée.");
    }
  },1000);
}

function stopTimer(){
  clearInterval(timerId);
}

function updateTimerUI(){
  document.getElementById("hudTime").textContent = timeLeft;
}

/* =====================================================
   QUESTIONS (EXEMPLE STRUCTURE)
===================================================== */
const questions = [
  {
    title:"Reconnaître l’étouffement",
    desc:"La victime ne peut pas parler et tousse faiblement.",
    options:[
      {text:"Obstruction légère", kind:"wrong"},
      {text:"Obstruction sévère", kind:"ok"},
      {text:"Crise d’angoisse", kind:"wrong"}
    ],
    feedback:{
      ok:"✅ Correct : obstruction sévère.",
      wrong:"❌ Mauvaise analyse."
    }
  }
  // (les autres questions restent inchangées)
];

/* =====================================================
   AFFICHAGE QUESTION
===================================================== */
function setQuestion(i, resetAttempts=true){
  locked = false;
  selectedOption = null;
  clearInterval(timerId);

  if(resetAttempts){
    attemptsForCurrentQuestion = 0;
    updateAttemptsUI();
  }

  const q = questions[i];
  document.getElementById("qTitle").textContent = q.title;
  document.getElementById("qDesc").textContent = q.desc;

  const optionsEl = document.getElementById("options");
  optionsEl.innerHTML = "";

  q.options.forEach((opt)=>{
    const div = document.createElement("div");
    div.className = "opt";
    div.textContent = opt.text;

    div.onclick = ()=>{
      document.querySelectorAll(".opt").forEach(o=>o.classList.remove("sel"));
      div.classList.add("sel");
      selectedOption = opt;
    };

    optionsEl.appendChild(div);
  });

  document.getElementById("submitBtn").style.display = "inline-block";
  startTimer();
}

/* =====================================================
   VALIDATION
===================================================== */
document.getElementById("submitBtn").onclick = ()=>{
  if(!selectedOption) return;

  stopTimer(); // ✅ chrono s’arrête ici
  locked = true;

  if(selectedOption.kind === "ok"){
    showFeedback(true);
  } else {
    attemptsForCurrentQuestion++;
    updateAttemptsUI();

    if(attemptsForCurrentQuestion >= 2){
      missionFail("❌ Deux tentatives ratées. Mission échouée.");
    } else {
      showFeedback(false);
    }
  }
};

/* =====================================================
   FEEDBACK
===================================================== */
function showFeedback(isCorrect){
  const overlay = document.getElementById("overlay");
  overlay.style.display = "flex";

  document.getElementById("modalText").textContent =
    isCorrect ? questions[idx].feedback.ok : questions[idx].feedback.wrong;

  document.getElementById("retryBtn").style.display = isCorrect ? "none" : "inline-block";
  document.getElementById("nextBtn").style.display  = isCorrect ? "inline-block" : "none";
}

/* =====================================================
   RETRY / NEXT
===================================================== */
document.getElementById("retryBtn").onclick = ()=>{
  document.getElementById("overlay").style.display = "none";
  setQuestion(idx,false); // ❌ pas reset tentatives
};

document.getElementById("nextBtn").onclick = ()=>{
  document.getElementById("overlay").style.display = "none";
  idx++;
  if(idx < questions.length) setQuestion(idx,true);
};

/* =====================================================
   MISSION FAIL
===================================================== */
function missionFail(msg){
  clearInterval(timerId);
  document.getElementById("modalText").textContent = msg;
  document.getElementById("retryBtn").style.display = "none";
  document.getElementById("nextBtn").style.display = "none";
  document.getElementById("okBtn").style.display = "inline-block";
  document.getElementById("overlay").style.display = "flex";
}

/* =====================================================
   START
===================================================== */
document.getElementById("startBtn").onclick = ()=>{
  idx = 0;
  attemptsForCurrentQuestion = 0;
  updateAttemptsUI();
  document.getElementById("startOverlay").style.display = "none";
  setQuestion(0,true);
};

function updateAttemptsUI(){
  document.getElementById("hudAttempts").textContent = attemptsForCurrentQuestion;
}
</script>
</body>
</html>
