<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Urgences – Choix de l’avatar</title>

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

  <style>
    html, body { background: transparent; margin: 0; color: #fff; }

    .page-wrap{
      min-height: 100vh;
      display:flex;
      align-items:center;
      justify-content:center;
      padding: 32px 18px;
      position: relative;
    }

    .glass{
      width: min(980px, 100%);
      background: rgba(0,0,0,.42);
      border: 1px solid rgba(255,255,255,.14);
      backdrop-filter: blur(10px);
      border-radius: 22px;
      box-shadow: 0 18px 50px rgba(0,0,0,.35);
      overflow: hidden;
      position: relative;
    }

    #fx{
      position:absolute;
      inset:0;
      width:100%;
      height:100%;
      pointer-events:none;
      opacity:.85;
      mix-blend-mode:screen;
      z-index:1;
    }

    .header{
      padding:18px 18px 12px;
      border-bottom:1px solid rgba(255,255,255,.1);
      position:relative;
      z-index:2;
    }

    .hello{
      margin:0 0 10px;
      font-weight:900;
      font-size:clamp(22px,2.4vw,34px);
      text-shadow:0 12px 30px rgba(0,0,0,.55);
    }

    .hello .name{
      color:rgba(255,190,110,1);
      text-shadow:0 0 18px rgba(255,165,0,.35);
    }

    .subtitle{
      margin:0;
      font-size:13px;
      color:rgba(255,255,255,.72);
    }

    .trio-wrap{
      padding:18px;
      display:flex;
      justify-content:center;
      z-index:2;
      position:relative;
    }

    .trio{
      width:min(760px,100%);
      height:360px;
      position:relative;
      display:flex;
      justify-content:center;
      align-items:flex-end;
    }

    .avatar-pick{
      position:absolute;
      bottom:0;
      height:330px;
      cursor:pointer;
      user-select:none;
      --tx:0px;
      --sx:1;
      --ty:0px;
      transform:translateX(var(--tx)) translateY(var(--ty)) scale(var(--sx));
      transform-origin:bottom center;
      filter:drop-shadow(0 18px 18px rgba(0,0,0,.45));
      transition:transform .16s ease, filter .16s ease, opacity .16s ease;
      opacity:.98;
    }

    .left{left:6%;--sx:.96}
    .center{left:50%;--tx:-50%;--sx:1.03;z-index:3}
    .right{right:6%;--sx:.96}

    .avatar-pick:hover{--ty:-6px}

    .selected{
      --ty:-10px;
      filter:drop-shadow(0 26px 28px rgba(0,0,0,.65))
             drop-shadow(0 0 18px rgba(255,165,0,.55));
      z-index:6;
      opacity:1;
    }

    .dimmed{opacity:.55}

    .footer{
      padding:14px 18px 18px;
      border-top:1px solid rgba(255,255,255,.1);
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:10px;
      flex-wrap:wrap;
      z-index:2;
      position:relative;
    }

    .badge-ready{
      display:none;
      background:rgba(25,135,84,.22);
      border:1px solid rgba(25,135,84,.35);
      padding:8px 12px;
      border-radius:999px;
      font-size:12px;
    }

    .btn-ember{
      display:none;
      border:0;
      border-radius:14px;
      padding:10px 14px;
      font-weight:900;
      background:linear-gradient(180deg,#ffb05a,#ff7832);
      color:#0a0c12;
      box-shadow:0 16px 35px rgba(255,120,50,.22);
    }

    .btn-ghost{
      border-radius:14px;
      border:1px solid rgba(255,255,255,.18);
      background:rgba(0,0,0,.12);
      color:rgba(255,255,255,.85);
      padding:10px 14px;
      font-weight:800;
    }

    @media(max-width:576px){
      .trio{height:270px}
      .avatar-pick{height:240px}
    }
  </style>
</head>

<body>
<div class="page-wrap">
  <div class="glass">
    <canvas id="fx"></canvas>

    <div class="header">
      <p class="hello" id="helloLine"></p>
      <p class="subtitle" id="roleLine"></p>
    </div>

    <div class="trio-wrap">
      <div class="trio" id="trio"></div>
    </div>

    <div class="footer">
      <div class="d-flex align-items-center gap-2">
        <span class="badge-ready" id="readyBadge">✅ Avatar sélectionné</span>
        <span class="text-white-50" style="font-size:12px" id="helpTxt">
          Clique sur un avatar pour le sélectionner.
        </span>
      </div>

      <div class="d-flex gap-2">
        <button type="button" class="btn-ghost" id="resetBtn">Réinitialiser</button>
        <button type="button" class="btn-ember" id="nextBtn">Suivant</button>
      </div>
    </div>
  </div>
</div>

<script>
  const playerName = localStorage.getItem("playerName") || "Joueur";
  document.getElementById("helloLine").innerHTML =
    `Bonjour <span class="name">${escapeHtml(playerName)}</span>, choisis ton avatar.`;

  const role = localStorage.getItem("role");
  const roleLine = document.getElementById("roleLine");

  const roleLabels = {
    medecin: "Métier choisi : Médecin",
    infirmier: "Métier choisi : Infirmier",
    pompier: "Métier choisi : Pompier"
  };

  roleLine.textContent = roleLabels[role] || "Aucun métier sélectionné.";

  const avatarsByRole = {
    medecin: [
      {pos:"left",file:"medecin_f.png"},
      {pos:"center",file:"medecin_f_voilee.png"},
      {pos:"right",file:"medecin_h.png"}
    ],
    infirmier: [
      {pos:"left",file:"infirmier_f.png"},
      {pos:"center",file:"infirmier_f_voilee.png"},
      {pos:"right",file:"infirmier_h.png"}
    ],
    pompier: [
      {pos:"left",file:"pompier_f.png"},
      {pos:"center",file:"pompier_f_voilee.png"},
      {pos:"right",file:"pompier_h.png"}
    ]
  };

  const trio = document.getElementById("trio");
  const readyBadge = document.getElementById("readyBadge");
  const nextBtn = document.getElementById("nextBtn");
  const resetBtn = document.getElementById("resetBtn");
  const helpTxt = document.getElementById("helpTxt");

  let selectedFile = null;

  function renderTrio(){
    trio.innerHTML="";
    (avatarsByRole[role] || []).forEach(item=>{
      const img=document.createElement("img");
      img.src=`assets/avatars/${item.file}`;
      img.className=`avatar-pick ${item.pos}`;
      img.dataset.file=item.file;
      img.onclick=()=>selectAvatar(item.file);
      trio.appendChild(img);
    });
  }

  function selectAvatar(file){
    selectedFile=file;
    document.querySelectorAll(".avatar-pick").forEach(el=>{
      el.classList.toggle("selected",el.dataset.file===file);
      el.classList.toggle("dimmed",el.dataset.file!==file);
    });
    localStorage.setItem("avatar",file);
    readyBadge.style.display="inline-flex";
    nextBtn.style.display="inline-block";
    helpTxt.textContent="Avatar enregistré. Tu peux continuer.";
  }

  resetBtn.onclick=(e)=>{
    e.preventDefault();
    selectedFile=null;
    localStorage.removeItem("avatar");
    document.querySelectorAll(".avatar-pick").forEach(el=>{
      el.classList.remove("selected","dimmed");
    });
    readyBadge.style.display="none";
    nextBtn.style.display="none";
    helpTxt.textContent="Clique sur un avatar pour le sélectionner.";
  };

  nextBtn.onclick=(e)=>{
    e.preventDefault();
    if(!selectedFile) return;
    alert("✅ Avatar enregistré. Continue dans Genially.");
  };

  function escapeHtml(str){
    return String(str).replace(/[&<>"']/g,m=>({
      "&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;","'":"&#039;"
    }[m]));
  }

  renderTrio();
</script>
</body>
</html>
