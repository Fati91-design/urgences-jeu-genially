<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Urgences ‚Äî Badges</title>

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Anton&display=swap" rel="stylesheet">

<style>
  :root{
    --glass: rgba(25,27,31,.72);
    --glass2: rgba(15,17,20,.55);
    --text: rgba(255,255,255,.93);
    --muted: rgba(255,255,255,.70);

    --gold: rgba(255,200,80,1);
    --red: rgba(255,70,70,1);
    --green: rgba(45,200,120,1);
    --blue: rgba(80,170,255,1);
    --ember: rgba(255,150,70,1);
    --ember2: rgba(255,120,50,1);
  }

  /* ‚úÖ MODIF 1: arri√®re-plan noir */
  html,body{
    margin:0;
    background:#000;            /* <-- noir */
    color:var(--text);
    font-family: system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
    overflow:hidden;
  }

  /* ‚úÖ Genially: sc√®ne fixe 16:9 + scale auto */
  .genially-stage{
    width:100vw; height:100vh;
    display:flex; align-items:center; justify-content:center;
    overflow:hidden;
    background:#000;            /* <-- noir (s√©curit√©) */
  }
  .genially-page{ width:1920px; height:1080px; position:relative; transform-origin:center; }
  .page-wrap{ position:absolute; inset:0; display:flex; align-items:center; justify-content:center; padding: 38px 52px; }

  /* =========================
     ‚úÖ APP MAIN (dashboard badges)
     - cach√© au d√©part (affich√© apr√®s CONTINUER)
  ========================= */
  #appMain{
    opacity: 0;
    transform: translateY(10px);
    display:none;
    transition: opacity .35s ease, transform .35s ease;

    /* ‚úÖ MODIF 2: centrer la "table" (le bloc dashboard) au milieu */
    width:100%;
    height:100%;
    align-items:center;
    justify-content:center;
    flex-direction:column;
  }
  #appMain.is-on{
    display:flex; /* <-- au lieu de block pour centrer */
  }
  #appMain.is-visible{
    opacity:1;
    transform: translateY(0);
  }

  /* ====== TITRE (comme ton style) ====== */
  .gameTitleWrap{
    text-align:center;
    margin: 0 0 16px;
    position: relative;
    isolation: isolate;
  }
  .topBadge{
    display:inline-flex;
    align-items:center;
    justify-content:center;
    padding: 7px 14px;
    border-radius: 999px;
    font-size: 12px;
    letter-spacing: .22em;
    text-transform: uppercase;
    color: rgba(255,255,255,.92);
    background: rgba(0,0,0,.35);
    border: 1px solid rgba(255,255,255,.16);
    backdrop-filter: blur(10px);
    box-shadow: 0 22px 60px rgba(0,0,0,.35);
    margin-bottom: 10px;
  }
  .gameTitleBack{
    font-family:'Anton', sans-serif;
    text-transform:uppercase;
    letter-spacing:.06em;
    font-size: 74px;
    line-height: .92;
    margin: 0;

    background: linear-gradient(180deg, #d7e9ff 0%, #86bfff 40%, #cfe3ff 100%);
    -webkit-background-clip:text; background-clip:text; color:transparent;

    text-shadow: 0 18px 70px rgba(0,0,0,.75), 0 0 45px rgba(120,190,255,.22);
  }
  .gameSubtitleBig{
    font-family:'Anton', sans-serif;
    text-transform:uppercase;
    letter-spacing:.05em;
    font-size: 56px;
    line-height: .92;
    margin: 6px 0 0;
    color: rgba(255,255,255,.98);
    text-shadow: 0 26px 90px rgba(0,0,0,.75), 0 0 28px rgba(255,255,255,.08);
  }
  .gameTitleWrap::before{
    content:"";
    position:absolute;
    inset: -22px -10px -10px -10px;
    background: radial-gradient(closest-side, rgba(255,255,255,.10), transparent 70%);
    filter: blur(10px);
    opacity: .60;
    z-index: 0;
    pointer-events:none;
  }

  /* ====== GRAND CONTENEUR ====== */
  .glass{
    width: min(1650px, 100%);
    background: rgba(0,0,0,.42);
    border: 1px solid rgba(255,255,255,.14);
    backdrop-filter: blur(12px);
    border-radius: 26px;
    box-shadow: 0 22px 80px rgba(0,0,0,.55);
    overflow: hidden;
    position: relative;

    /* ‚úÖ MODIF 2: centrer horizontalement */
    margin: 0 auto;
  }
  .glass::before{
    content:"";
    position:absolute;
    inset:-2px;
    background:
      radial-gradient(900px 260px at 30% 0%, rgba(255,150,70,.14), transparent 60%),
      radial-gradient(900px 260px at 75% 120%, rgba(80,170,255,.10), transparent 60%);
    opacity:.9;
    pointer-events:none;
  }

  /* ====== TOP BAR (message + pills + filtres) ====== */
  .topbar{
    position: relative;
    z-index: 2;
    padding: 18px 22px 14px;
    border-bottom: 1px solid rgba(255,255,255,.10);
    display:flex;
    align-items:flex-start;
    justify-content:space-between;
    gap: 16px;
  }
  .hello{
    margin:0 0 4px;
    font-weight: 950;
    font-size: 30px;
    text-shadow: 0 12px 30px rgba(0,0,0,.55);
  }
  .hello .name{
    color: rgba(255,190,110,1);
    text-shadow: 0 0 14px rgba(255,165,0,.35);
  }
  .subtitle{
    margin:0;
    font-size: 14px;
    color: rgba(255,255,255,.75);
  }

  .pillRow{ display:flex; gap:10px; flex-wrap:wrap; margin-top: 10px; }
  .pill{
    padding: 7px 12px;
    border-radius: 999px;
    font-size: 12px;
    font-weight: 950;
    letter-spacing: .12em;
    text-transform: uppercase;
    border: 1px solid rgba(255,255,255,.18);
    background: rgba(0,0,0,.25);
    color: rgba(255,255,255,.88);
    white-space: nowrap;
    display:inline-flex;
    gap:8px;
    align-items:center;
  }
  .pillDot{ width:8px; height:8px; border-radius:999px; background: rgba(255,255,255,.35); }
  .pill.gold{ border-color: rgba(255,200,80,.28); }
  .pill.gold .pillDot{ background: rgba(255,200,80,.95); box-shadow: 0 0 0 5px rgba(255,200,80,.12); }
  .pill.silver{ border-color: rgba(160,210,255,.28); }
  .pill.silver .pillDot{ background: rgba(120,190,255,.95); box-shadow: 0 0 0 5px rgba(120,190,255,.12); }
  .pill.bronze{ border-color: rgba(255,150,70,.25); }
  .pill.bronze .pillDot{ background: rgba(255,150,70,.95); box-shadow: 0 0 0 5px rgba(255,150,70,.12); }

  .filterWrap{ display:flex; gap:10px; align-items:center; flex-wrap:wrap; justify-content:flex-end; }
  .filterBtn{
    border: 1px solid rgba(255,255,255,.18);
    background: rgba(0,0,0,.28);
    color: rgba(255,255,255,.92);
    border-radius: 999px;
    padding: 8px 12px;
    font-weight: 950;
    letter-spacing: .12em;
    text-transform: uppercase;
    font-size: 12px;
    cursor:pointer;
    transition: transform .15s ease, filter .15s ease, border-color .15s ease;
    user-select:none;
  }
  .filterBtn:hover{ transform: translateY(-1px); filter: brightness(1.06); }
  .filterBtn.active{
    border-color: rgba(255,165,0,.55);
    box-shadow: 0 0 0 4px rgba(255,165,0,.12);
  }

  /* ====== BODY: AVATAR GAUCHE + LISTE BADGES DROITE ====== */
  .body{
    position: relative;
    z-index: 2;
    padding: 18px 20px 18px;
  }

  .panelGrid{
    display:grid;
    grid-template-columns: 420px 1fr;
    gap: 16px;
    align-items: stretch;
    min-height: 640px;
  }

  /* gauche */
  .leftPanel{
    background: rgba(0,0,0,.28);
    border: 1px solid rgba(255,255,255,.12);
    border-radius: 22px;
    overflow:hidden;
    box-shadow: 0 16px 60px rgba(0,0,0,.35);
    position: relative;
  }
  .leftPanel::before{
    content:"";
    position:absolute; inset:-2px;
    background: radial-gradient(500px 220px at 50% 0%, rgba(120,190,255,.14), transparent 60%);
    opacity:.9;
    pointer-events:none;
  }
  .leftTopTag{
    position:absolute;
    top: 14px; left: 14px;
    z-index: 2;
    padding: 7px 12px;
    border-radius: 999px;
    font-size: 12px;
    letter-spacing: .18em;
    text-transform: uppercase;
    font-weight: 950;
    color: rgba(255,255,255,.92);
    background: rgba(0,0,0,.38);
    border: 1px solid rgba(255,255,255,.14);
    backdrop-filter: blur(10px);
  }
  .avatarBig{
    width: 100%;
    height: 100%;
    object-fit: cover;
    object-position: 50% 10%;
    filter: saturate(1.05) contrast(1.02);
    transform: scale(1.05);
  }
  .leftBottomName{
    position:absolute;
    bottom: 14px; left: 16px; right: 16px;
    z-index: 2;
    display:flex; align-items:center; justify-content:space-between;
    gap:10px;
  }
  .lbText{
    font-weight: 950;
    font-size: 20px;
    text-shadow: 0 18px 45px rgba(0,0,0,.75);
  }
  .lbSub{
    font-size: 12px;
    color: rgba(255,255,255,.70);
    font-weight: 900;
  }

  /* droite */
  .rightPanel{
    background: rgba(0,0,0,.18);
    border: 1px solid rgba(255,255,255,.10);
    border-radius: 22px;
    box-shadow: 0 16px 60px rgba(0,0,0,.30);
    overflow:hidden;
    display:flex;
    flex-direction:column;
    min-height: 640px;
  }
  .rightHeader{
    padding: 16px 16px 12px;
    border-bottom: 1px solid rgba(255,255,255,.10);
    display:flex;
    align-items:center;
    justify-content:space-between;
    gap: 12px;
    flex-wrap:wrap;
  }
  .rhTitle{
    font-weight: 950;
    letter-spacing: .12em;
    text-transform: uppercase;
    font-size: 14px;
    color: rgba(255,255,255,.86);
  }
  .rhProgress{
    color: rgba(255,255,255,.72);
    font-weight: 900;
    font-size: 13px;
  }

  .listArea{
    padding: 14px 14px 10px;
    overflow:auto;
    flex: 1 1 auto;
  }

  .badgeRow{
    display:flex;
    align-items:center;
    justify-content:space-between;
    gap: 14px;
    padding: 12px 12px;
    border-radius: 18px;
    border: 1px solid rgba(255,255,255,.12);
    background: rgba(0,0,0,.22);
    box-shadow: 0 14px 40px rgba(0,0,0,.25);
    margin-bottom: 12px;
    opacity: 0;
    transform: translateY(10px);
    animation: rowIn .5s ease forwards;
  }
  @keyframes rowIn{
    to{ opacity: 1; transform: translateY(0); }
  }

  .bLeft{ display:flex; align-items:center; gap: 12px; min-width: 0; }
  .bThumb{
    width: 62px; height: 62px;
    border-radius: 18px;
    background: rgba(255,255,255,.06);
    border: 1px solid rgba(255,255,255,.14);
    display:grid;
    place-items:center;
    overflow:hidden;
    flex: 0 0 auto;
  }
  .bThumb img{ width: 44px; height: 44px; object-fit: contain; display:block; }
  .bText{ min-width: 0; }
  .bTitle{
    font-weight: 950;
    font-size: 16px;
    white-space: nowrap;
    overflow:hidden;
    text-overflow: ellipsis;
  }
  .bMeta{
    margin-top: 4px;
    color: rgba(255,255,255,.70);
    font-weight: 900;
    font-size: 12px;
    display:flex;
    gap: 10px;
    flex-wrap: wrap;
  }
  .chipMini{
    padding: 6px 10px;
    border-radius: 999px;
    font-size: 11px;
    font-weight: 950;
    letter-spacing: .10em;
    text-transform: uppercase;
    border: 1px solid rgba(255,255,255,.14);
    background: rgba(0,0,0,.22);
    white-space: nowrap;
  }
  .chipMini.gold{ border-color: rgba(255,200,80,.28); }
  .chipMini.silver{ border-color: rgba(120,190,255,.28); }
  .chipMini.bronze{ border-color: rgba(255,150,70,.25); }

  .bRight{ display:flex; align-items:center; gap: 10px; flex-wrap:wrap; justify-content:flex-end; }

  .btn-ember{
    border:0;
    border-radius:14px;
    padding:10px 16px;
    font-weight:950;
    font-size: 13px;
    letter-spacing:.10em;
    text-transform:uppercase;
    background: linear-gradient(180deg,#ffb05a,#ff7832);
    color:#0a0c12;
    box-shadow:0 14px 30px rgba(255,120,50,.22);
    transition: transform .15s ease, filter .15s ease;
    white-space: nowrap;
    cursor:pointer;
  }
  .btn-ember:hover{ transform: translateY(-2px); filter: brightness(1.06); }

  .btnGhost{
    border-radius:14px;
    padding:10px 16px;
    font-weight:950;
    font-size: 13px;
    letter-spacing:.10em;
    text-transform:uppercase;
    border: 1px solid rgba(140,200,255,.55);
    background: rgba(0,0,0,.28);
    color: rgba(255,255,255,.92);
    box-shadow: 0 16px 50px rgba(0,0,0,.30);
    transition: transform .15s ease, filter .15s ease;
    cursor:pointer;
  }
  .btnGhost:hover{ transform: translateY(-2px); filter: brightness(1.08); }

  .footer{
    padding: 12px 16px;
    border-top: 1px solid rgba(255,255,255,.10);
    display:flex;
    align-items:center;
    justify-content:space-between;
    gap: 12px;
    flex-wrap:wrap;
    color: rgba(255,255,255,.72);
    font-size: 13px;
  }

  /* ====== OVERLAYS ====== */
  .overlay{
    position: absolute;
    inset: 0;
    display:none;
    align-items:center;
    justify-content:center;
    z-index: 50;
    background: rgba(0,0,0,.45);
    backdrop-filter: blur(10px);
  }

  /* =========================
     ‚úÖ √âCRAN F√âLICITATIONS
     ‚úÖ (premi√®re page affich√©e)
  ========================= */
  #badgeFullscreen{
    display:flex;                 /* ‚úÖ visible au d√©part */
    align-items:center;
    justify-content:center;
    position:absolute;
    inset:0;
    z-index: 90;
    background:
      radial-gradient(1200px 520px at 50% 25%, rgba(120,190,255,.12), transparent 60%),
      radial-gradient(900px 420px at 35% 95%, rgba(255,150,70,.10), transparent 60%),
      rgba(0,0,0,.78);
    backdrop-filter: blur(10px);
    opacity:0;
    animation: overlayIn .35s ease forwards;
  }
  @keyframes overlayIn{ to{ opacity:1; } }

  .bfCard{
    width: min(1500px, 92%);
    border-radius: 28px;
    background: rgba(0,0,0,.30);
    border: 1px solid rgba(255,255,255,.14);
    box-shadow: 0 26px 120px rgba(0,0,0,.75);
    overflow:hidden;
    position: relative;
    margin: 0 auto;
    transform: translateY(8px) scale(.985);
    opacity:0;
    animation: cardIn .45s cubic-bezier(.2,.9,.2,1) .08s forwards;
  }
  @keyframes cardIn{
    to{ transform: translateY(0) scale(1); opacity:1; }
  }
  .bfCard::before{
    content:"";
    position:absolute; inset:-2px;
    background: linear-gradient(120deg, rgba(255,255,255,.10), transparent 40%, rgba(255,255,255,.08));
    opacity:.22;
    pointer-events:none;
    transform: translateX(-12%);
    animation: shimmer 3.6s ease-in-out infinite;
  }
  @keyframes shimmer{
    0%,100%{ transform: translateX(-12%); opacity:.16; }
    50%{ transform: translateX(12%); opacity:.26; }
  }

  .bfTop{
    padding: 16px 18px;
    border-bottom: 1px solid rgba(255,255,255,.10);
    display:flex;
    align-items:center;
    justify-content:space-between;
    gap: 10px;
  }
  .bfTag{
    display:inline-flex;
    align-items:center;
    gap:10px;
    padding: 8px 12px;
    border-radius: 999px;
    border: 1px solid rgba(255,255,255,.14);
    background: rgba(0,0,0,.38);
    font-weight: 950;
    letter-spacing: .12em;
    text-transform: uppercase;
    font-size: 12px;
    color: rgba(255,255,255,.92);
  }
  .closeX{
    width: 40px; height: 40px;
    border-radius: 14px;
    border: 1px solid rgba(255,255,255,.14);
    background: rgba(255,255,255,.06);
    color: rgba(255,255,255,.92);
    display:grid; place-items:center;
    font-weight: 950;
    cursor:pointer;
    user-select:none;
  }

  .bfBody{ padding: 26px 22px 18px; }

  .bfTitle{
    font-family:'Anton', sans-serif;
    letter-spacing:.06em;
    text-transform:uppercase;
    font-size: 92px;
    margin: 0;
    line-height: .92;
    text-align:center;
    background: linear-gradient(180deg, #d7e9ff 0%, #86bfff 40%, #cfe3ff 100%);
    -webkit-background-clip:text; background-clip:text; color:transparent;
    text-shadow: 0 22px 90px rgba(0,0,0,.72), 0 0 40px rgba(120,190,255,.18);
  }

  .bfMsg{
    margin-top: 10px;
    color: rgba(255,255,255,.80);
    font-weight: 900;
    font-size: 15px;
    text-align:center;
  }

  .bfMain{
    margin: 16px auto 0;
    width: min(1120px, 100%);
    border-radius: 24px;
    border: 1px solid rgba(255,255,255,.12);
    background: rgba(0,0,0,.22);
    padding: 18px;
    display:flex;
    align-items:center;
    gap: 16px;
  }

  .bfBadgeBig{
    width: 110px; height: 110px;
    border-radius: 26px;
    background: rgba(255,255,255,.06);
    border: 1px solid rgba(255,255,255,.14);
    display:grid;
    place-items:center;
    overflow:hidden;
    flex: 0 0 auto;
    box-shadow: 0 20px 70px rgba(0,0,0,.35);
  }
  .bfBadgeBig img{ width: 74px; height: 74px; object-fit: contain; display:block; }

  .bfInfo{ min-width:0; flex: 1 1 auto; }
  .bfLine1{
    font-weight: 950;
    font-size: 20px;
    white-space: nowrap;
    overflow:hidden;
    text-overflow: ellipsis;
  }
  .bfLine2{
    margin-top: 4px;
    color: rgba(255,255,255,.70);
    font-weight: 900;
    font-size: 13px;
  }
  .bfPills{ display:flex; gap: 10px; flex-wrap:wrap; margin-top: 10px; justify-content:flex-start; }

  .bfActions{
    margin-top: 16px;
    display:flex;
    justify-content:center;
    gap: 12px;
    flex-wrap:wrap;
  }

  /* Confetti (l√©ger) */
  .confetti{
    position:absolute;
    inset:0;
    pointer-events:none;
    overflow:hidden;
    z-index: 95;
  }
  .confetti i{
    position:absolute;
    top: -20px;
    width: 10px;
    height: 18px;
    border-radius: 3px;
    opacity:.95;
    animation: fall linear forwards;
    filter: blur(.15px);
  }
  @keyframes fall{
    to{ transform: translateY(1150px) rotate(420deg); opacity: 0.95; }
  }

  /* ====== Ready overlay ====== */
  #readyOverlay{ background: rgba(0,0,0,.85); backdrop-filter:none; }
  .readyBox{
    width: min(900px, 92%);
    border-radius: 26px;
    background: rgba(0,0,0,.38);
    border: 1px solid rgba(255,255,255,.14);
    box-shadow: 0 26px 110px rgba(0,0,0,.75);
    padding: 22px 22px 18px;
    text-align:center;
  }
  .readyTitle{
    font-family:'Anton', sans-serif;
    font-size: 62px;
    letter-spacing:.05em;
    text-transform:uppercase;
    margin: 0;
    color: rgba(255,255,255,.96);
    text-shadow: 0 26px 90px rgba(0,0,0,.75);
  }
  .readySub{
    margin-top: 10px;
    color: rgba(255,255,255,.78);
    font-weight: 900;
  }

  @media (max-width: 980px){
    .panelGrid{ grid-template-columns: 1fr; }
    .leftPanel{ height: 280px; }
    .bfTitle{ font-size: 62px; }
    .gameTitleBack{ font-size: 58px; }
    .gameSubtitleBig{ font-size: 44px; }
    .bfMain{ flex-direction:column; align-items:flex-start; }
    .bfActions{ justify-content:center; }
  }
</style>
</head>

<body>
<div class="genially-stage">
  <div class="genially-page" id="geniallyPage">
    <div class="page-wrap">
      <div class="container-fluid px-0">

        <!-- =========================
             ‚úÖ PAGE 2 : Dashboard badges
             (affich√© apr√®s CONTINUER)
        ========================== -->
        <div id="appMain">

          <!-- TITRE -->
          <div class="gameTitleWrap">
            <div class="topBadge">COLLECTION</div>
            <h1 class="gameTitleBack">URGENCES</h1>
            <h2 class="gameSubtitleBig">BADGES OBTENUS</h2>
          </div>

          <!-- GRAND CONTENEUR -->
          <div class="glass">

            <!-- TOP BAR -->
            <div class="topbar">
              <div>
                <p class="hello" id="helloLine"></p>
                <p class="subtitle">Filtre par niveau, consulte tes badges et progresse jusqu‚Äôau OR.</p>

                <div class="pillRow">
                  <span class="pill gold" id="pillOr"><span class="pillDot"></span> OR <b id="cntOr">0</b></span>
                  <span class="pill silver" id="pillArgent"><span class="pillDot"></span> ARGENT <b id="cntArgent">0</b></span>
                  <span class="pill bronze" id="pillBronze"><span class="pillDot"></span> BRONZE <b id="cntBronze">0</b></span>
                </div>
              </div>

              <div class="filterWrap">
                <button class="filterBtn" data-filter="debutant">D√âBUTANT</button>
                <button class="filterBtn" data-filter="intermediaire">INTERM√âDIAIRE</button>
                <button class="filterBtn" data-filter="expert">EXPERT</button>
              </div>
            </div>

            <!-- BODY (avatar √† gauche + liste √† droite) -->
            <div class="body">
              <div class="panelGrid">

                <!-- LEFT: avatar -->
                <div class="leftPanel">
                  <div class="leftTopTag">NOUVEAU BADGE ‚Äî URGENCES</div>
                  <img id="avatarBig" class="avatarBig" alt="avatar">
                  <div class="leftBottomName">
                    <div>
                      <div class="lbText" id="lbName">Bravo Joueur</div>
                      <div class="lbSub" id="lbRole">Continue : chaque seconde compte.</div>
                    </div>
                  </div>
                </div>

                <!-- RIGHT: badges list -->
                <div class="rightPanel">
                  <div class="rightHeader">
                    <div class="rhTitle" id="rhTitle">BADGES ‚Äî NIVEAU : D√âBUTANT</div>
                    <div class="rhProgress" id="rhProgress">Badges obtenus : 0/4</div>
                  </div>

                  <div class="listArea" id="badgesList"></div>

                  <div class="footer">
                    <div id="footTxt">Filtre actif : <b id="footFilter">D√âBUTANT</b>. Badges gagn√©s : <b id="footGot">0</b>/4</div>
                    <button class="btn-ember" id="continueBtn" type="button">CONTINUER</button>
                  </div>
                </div>

              </div>
            </div>

          </div>

          <!-- Ready overlay -->
          <div class="overlay" id="readyOverlay">
            <div class="readyBox">
              <h2 class="readyTitle">Pr√™t pour la nouvelle mission ?</h2>
              <div class="readySub">Si tu es pr√™t, clique sur <b>OUI</b>.</div>
              <div style="margin-top:16px;">
                <button class="btn-ember" id="readyYes" type="button">OUI</button>
              </div>
            </div>
          </div>

        </div>

        <!-- =========================
             ‚úÖ PAGE 1 : F√©licitations (au chargement)
             (CONTINUER => affiche appMain)
        ========================== -->
        <div id="badgeFullscreen">
          <div class="confetti" id="confetti"></div>

          <div class="bfCard">
            <div class="bfTop">
              <div class="bfTag">NOUVEAU BADGE ‚Äî URGENCES</div>
              <div class="closeX" id="bfClose">‚úï</div>
            </div>

            <div class="bfBody">
              <h1 class="bfTitle">F√âLICITATIONS !</h1>
              <div class="bfMsg" id="bfMsg">üî• Tu avances vite, Joueur. Continue : chaque seconde compte.</div>

              <div class="bfMain">
                <div class="bfBadgeBig">
                  <img id="bfImg" src="" alt="badge">
                </div>

                <div class="bfInfo">
                  <div class="bfLine1" id="bfLine1">üèÖ URGENCES ‚Äî Sc√©nario ?</div>
                  <div class="bfLine2" id="bfLine2">Niveau D√âBUTANT ‚Ä¢ Score 0</div>
                  <div class="bfPills">
                    <span class="pill"><span class="pillDot"></span> ‚≠ê SCORE : <b id="bfScore">0</b></span>
                    <span class="pill"><span class="pillDot"></span> üéö NIVEAU : <b id="bfLvl">D√âBUTANT</b></span>
                    <span class="pill"><span class="pillDot"></span> üß© MISSION : <b id="bfMission">‚Äî</b></span>
                  </div>
                </div>
              </div>

              <div class="bfActions">
                <button class="btn-ember" id="bfContinue" type="button">CONTINUER</button>
                <button class="btnGhost" id="bfNoShow" type="button">NE PLUS R√âAFFICHER</button>
              </div>
            </div>
          </div>
        </div>

      </div>
    </div>
  </div>
</div>

<script>
/* =========================
   ‚úÖ SCALE AUTO (Genially)
========================= */
(function scaleGeniallyPage(){
  const page = document.getElementById('geniallyPage');
  function apply(){
    const sw = window.innerWidth / 1920;
    const sh = window.innerHeight / 1080;
    const s = Math.min(sw, sh);
    page.style.transform = `scale(${s})`;
  }
  window.addEventListener('resize', apply);
  apply();
})();

/* =========================
   ‚úÖ AUDIO SFX (l√©ger)
========================= */
let audioCtx = null;
function ensureAudio(){ if(!audioCtx) audioCtx = new (window.AudioContext||window.webkitAudioContext)(); }
function tone(freq, dur=0.08, type="sine", gain=0.05){
  ensureAudio();
  const t0 = audioCtx.currentTime;
  const osc = audioCtx.createOscillator();
  const g = audioCtx.createGain();
  osc.type = type; osc.frequency.value = freq;
  g.gain.value = gain;
  osc.connect(g); g.connect(audioCtx.destination);
  osc.start(t0); osc.stop(t0 + dur);
}
function sfxClick(){ tone(520,0.04,"triangle",0.035); }
function sfxVictory(){
  const notes = [
    {f:659,d:0.10},{f:784,d:0.10},{f:988,d:0.14},
    {f:1175,d:0.18},{f:988,d:0.14},{f:1047,d:0.22}
  ];
  let t = 0;
  notes.forEach((n)=>{ setTimeout(()=>tone(n.f, n.d, "sine", 0.065), t*1000); t += n.d + 0.03; });
}

/* =========================
   ‚úÖ HELPERS
========================= */
const $ = (id)=>document.getElementById(id);
function escapeHtml(str){
  return String(str||"").replace(/[&<>"']/g,m=>({ "&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;","'":"&#039;" }[m]));
}
function normalizeDifficultyKey(d){
  const x = String(d||"").toLowerCase();
  if(x.includes("inter")) return "INTERMEDIAIRE";
  if(x.includes("expert")) return "EXPERT";
  return "DEBUTANT";
}
function prettyDifficulty(d){
  const k = normalizeDifficultyKey(d);
  if(k==="INTERMEDIAIRE") return "INTERM√âDIAIRE";
  if(k==="EXPERT") return "EXPERT";
  return "D√âBUTANT";
}
function badgeTypeFromAny(b){
  const t = (b?.type || b?.badgeType || b?.badgeLevel || "").toString().toUpperCase();
  if(t.includes("OR")) return "OR";
  if(t.includes("ARG")) return "ARGENT";
  return "BRONZE";
}
function badgeImgFromAny(b){
  return b?.img || b?.badgeImage || b?.image || "";
}
function badgeMissionFromAny(b){
  return b?.mission || b?.scenarioMission || b?.label || b?.scenarioLabel || b?.name || "Mission";
}
function badgeScoreFromAny(b){
  const v = (b?.score ?? b?.finalScore ?? 0);
  const n = parseInt(v,10);
  return isNaN(n) ? 0 : n;
}
function badgeDateFromTs(ts){
  if(!ts) return "";
  try{
    const d = new Date(ts);
    const pad=(x)=>String(x).padStart(2,"0");
    return `${pad(d.getDate())}/${pad(d.getMonth()+1)}/${d.getFullYear()} ‚Ä¢ ${pad(d.getHours())}:${pad(d.getMinutes())}`;
  }catch(e){ return ""; }
}

/* =========================
   ‚úÖ PROFIL (nom/avatar)
========================= */
const playerName =
  localStorage.getItem("player_name") ||
  localStorage.getItem("playerName") ||
  "Joueur";

const role = localStorage.getItem("role") || "";
const roleLabels = { medecin:"M√©decin", infirmier:"Infirmier", pompier:"Pompier" };

const avatarFile = localStorage.getItem("avatar") || "medecin_f.png";

/* =========================
   ‚úÖ BADGES STORAGE
========================= */
const SCENARIOS = [
  { id: 1, label: "Sc√©nario 1" },
  { id: 2, label: "Sc√©nario 2" },
  { id: 3, label: "Sc√©nario 3" },
  { id: 4, label: "Sc√©nario 4" }
];

function readBadgeByScenarioAndDiff(scenarioId, diffKey){
  const keysToTry = [
    `badge_s${scenarioId}_${diffKey}`,
    `badge_s${scenarioId}_${prettyDifficulty(diffKey)}`,
    `badge_s${scenarioId}_${diffKey.toLowerCase()}`,
    `badge_s${scenarioId}`
  ];
  for(const k of keysToTry){
    const raw = localStorage.getItem(k);
    if(!raw) continue;
    try{
      const obj = JSON.parse(raw);
      if(obj && typeof obj==="object") return { key:k, obj };
    }catch(e){}
  }
  return null;
}

/* =========================
   ‚úÖ FILTER
========================= */
let activeFilterKey = normalizeDifficultyKey(
  localStorage.getItem("badges_filter") ||
  localStorage.getItem("niveau") ||
  localStorage.getItem("difficulty") ||
  "debutant"
);

const filterBtns = document.querySelectorAll(".filterBtn");
filterBtns.forEach(btn=>{
  btn.addEventListener("click", ()=>{
    sfxClick();
    activeFilterKey = normalizeDifficultyKey(btn.dataset.filter);
    localStorage.setItem("badges_filter", activeFilterKey);
    refreshUI();
  });
});

function setActiveFilterUI(){
  filterBtns.forEach(b=>{
    b.classList.toggle("active", normalizeDifficultyKey(b.dataset.filter) === activeFilterKey);
  });
  $("rhTitle").textContent = `BADGES ‚Äî NIVEAU : ${prettyDifficulty(activeFilterKey)}`;
  $("footFilter").textContent = prettyDifficulty(activeFilterKey);
}

/* =========================
   ‚úÖ RENDER LIST (uniquement gagn√©s)
========================= */
function renderList(){
  const host = $("badgesList");
  host.innerHTML = "";

  let got = 0;
  let cntOR = 0, cntARG = 0, cntBR = 0;

  const items = [];

  SCENARIOS.forEach(sc=>{
    const found = readBadgeByScenarioAndDiff(sc.id, activeFilterKey);
    if(!found) return;

    const b = found.obj;
    const type = badgeTypeFromAny(b);
    if(type==="OR") cntOR++;
    else if(type==="ARGENT") cntARG++;
    else cntBR++;

    got++;

    const img = badgeImgFromAny(b);
    const mission = badgeMissionFromAny(b);
    const score = badgeScoreFromAny(b);
    const ts = badgeDateFromTs(b.ts);

    items.push({
      scenarioId: sc.id,
      scenarioLabel: sc.label,
      type,
      img,
      mission,
      score,
      ts
    });
  });

  $("cntOr").textContent = String(cntOR);
  $("cntArgent").textContent = String(cntARG);
  $("cntBronze").textContent = String(cntBR);

  $("rhProgress").textContent = `Badges obtenus : ${got}/4`;
  $("footGot").textContent = String(got);

  if(items.length === 0){
    host.innerHTML = `
      <div style="padding:18px; border:1px dashed rgba(255,255,255,.18); border-radius:18px; background: rgba(0,0,0,.18);">
        <div style="font-weight:950; font-size:16px;">Aucun badge obtenu sur ce niveau.</div>
        <div style="margin-top:6px; color: rgba(255,255,255,.72); font-weight:900; font-size:13px;">
          Termine un sc√©nario puis reviens ici.
        </div>
      </div>
    `;
    return;
  }

  items.forEach((it, index)=>{
    const chipClass = (it.type==="OR") ? "gold" : (it.type==="ARGENT") ? "silver" : "bronze";
    const imgSrc = it.img ? `assets/${escapeHtml(it.img)}` : "assets/bronze.png";
    const delay = 80 * index;

    const row = document.createElement("div");
    row.className = "badgeRow";
    row.style.animationDelay = `${delay}ms`;
    row.innerHTML = `
      <div class="bLeft">
        <div class="bThumb"><img src="${imgSrc}" alt="badge"></div>
        <div class="bText">
          <div class="bTitle">üèÖ ${escapeHtml(it.scenarioLabel)} ‚Äî ${escapeHtml(it.mission)}</div>
          <div class="bMeta">
            <span class="chipMini ${chipClass}">${escapeHtml(prettyDifficulty(activeFilterKey))}</span>
            <span class="chipMini ${chipClass}">${escapeHtml(it.type)}</span>
            <span class="chipMini">‚≠ê ${escapeHtml(String(it.score))}</span>
            ${it.ts ? `<span class="chipMini">üïí ${escapeHtml(it.ts)}</span>` : ``}
          </div>
        </div>
      </div>
      <div class="bRight"></div>
    `;
    host.appendChild(row);
  });
}

/* =========================
   ‚úÖ CONFETTIS (effet f√™te)
========================= */
function spawnConfetti(){
  const c = $("confetti");
  c.innerHTML = "";
  const colors = ["rgba(255,200,80,.95)","rgba(255,150,70,.95)","rgba(120,190,255,.95)","rgba(255,255,255,.85)"];
  for(let i=0;i<30;i++){
    const p = document.createElement("i");
    const x = Math.random()*100;
    const d = 1.6 + Math.random()*1.5;
    const s = 8 + Math.random()*11;
    const r = Math.random()*360;
    p.style.left = x + "%";
    p.style.width = (s*0.55) + "px";
    p.style.height = s + "px";
    p.style.background = colors[Math.floor(Math.random()*colors.length)];
    p.style.animationDuration = d + "s";
    p.style.transform = `translateY(0) rotate(${r}deg)`;
    p.style.opacity = (0.70 + Math.random()*0.25);
    p.style.animationDelay = (Math.random()*0.18) + "s";
    c.appendChild(p);
  }
}

/* =========================
   ‚úÖ √âCRAN F√âLICITATIONS
   - lit last_badge_key
========================= */
function openCongrats(b){
  const type = badgeTypeFromAny(b);
  const img = badgeImgFromAny(b) || (type==="OR" ? "or.png" : type==="ARGENT" ? "argent.png" : "bronze.png");
  const mission = badgeMissionFromAny(b);
  const sc = b.scenario || b.scenarioId || "?";
  const lvl = prettyDifficulty(b.niveau || b.difficulty || activeFilterKey);
  const score = badgeScoreFromAny(b);

  $("bfImg").src = "assets/" + img;
  $("bfLine1").textContent = `üèÖ URGENCES ‚Äî Sc√©nario ${sc}`;
  $("bfLine2").textContent = `Niveau ${lvl} ‚Ä¢ Score ${score}`;
  $("bfScore").textContent = String(score);
  $("bfLvl").textContent = lvl;
  $("bfMission").textContent = String(mission || `Sc√©nario ${sc}`);

  $("bfMsg").innerHTML = `üî• Tu avances vite, <b>${escapeHtml(playerName)}</b>. Continue : chaque seconde compte.`;

  $("badgeFullscreen").style.display = "flex";
  spawnConfetti();
  sfxVictory();
}

function hideCongrats(){
  $("badgeFullscreen").style.display = "none";
}

function showAppMain(){
  const app = $("appMain");
  app.classList.add("is-on");
  requestAnimationFrame(()=> setTimeout(()=> app.classList.add("is-visible"), 20));
}

/* =========================
   ‚úÖ Events (liaison)
========================= */
$("bfClose").addEventListener("click", ()=>{
  sfxClick();
  hideCongrats();
  showAppMain();
});

$("bfNoShow").addEventListener("click", ()=>{
  sfxClick();
  localStorage.setItem("no_show_last_badge", "1");
  hideCongrats();
  showAppMain();
});

$("bfContinue").addEventListener("click", ()=>{
  sfxClick();
  hideCongrats();
  showAppMain();
});

/* =========================
   ‚úÖ Ready overlay (CONTINUER)
========================= */
$("continueBtn").addEventListener("click", ()=>{
  sfxClick();
  $("readyOverlay").style.display = "flex";
});
$("readyYes").addEventListener("click", ()=>{
  sfxClick();
  $("readyOverlay").style.display = "none";
});

/* =========================
   ‚úÖ REFRESH UI
========================= */
function refreshUI(){
  $("helloLine").innerHTML = `Bravo <span class="name">${escapeHtml(playerName)}</span> ‚Äî voici tes badges.`;
  $("avatarBig").src = "assets/avatars/" + avatarFile;
  $("lbName").textContent = `Bravo ${playerName}`;
  $("lbRole").textContent = roleLabels[role] ? `M√©tier : ${roleLabels[role]} ‚Ä¢ Continue !` : `Continue : chaque seconde compte.`;

  setActiveFilterUI();
  renderList();
}

/* =========================
   ‚úÖ INIT
========================= */
(function init(){
  refreshUI();

  const noShow = localStorage.getItem("no_show_last_badge")==="1";
  const lastKey = localStorage.getItem("last_badge_key");

  // Remplir l'√©cran f√©licitations si possible (sinon il reste en template)
  if(!noShow && lastKey){
    try{
      const raw = localStorage.getItem(lastKey);
      if(raw){
        const b = JSON.parse(raw);
        setTimeout(()=> openCongrats(b), 120);
      }else{
        spawnConfetti();
      }
    }catch(e){
      spawnConfetti();
    }
  }else{
    spawnConfetti();
  }
})();
</script>
</body>
</html>
