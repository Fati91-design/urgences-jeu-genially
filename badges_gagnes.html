<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>FIN ‚Äî BADGE OBTENU</title>

<style>
:root{
  --glass: rgba(25,27,31,.72);
  --glass2: rgba(15,17,20,.55);
  --text: rgba(255,255,255,.93);
  --gold: rgba(255,200,80,1);
  --blue: rgba(80,170,255,1);
  --border: rgba(255,200,150,.22);
  --shadow: 0 18px 70px rgba(0,0,0,.5);
}

html,body{
  margin:0;
  background:transparent;
  font-family: system-ui,Segoe UI,Roboto,Arial,sans-serif;
  color:var(--text);
}

/* ===== GLOBAL ===== */
.stage{
  min-height:100vh;
  display:flex;
  justify-content:center;
  align-items:center;
  padding:16px;
}
.wrap{
  width:min(1120px,100%);
  display:flex;
  flex-direction:column;
  gap:14px;
}

/* ===== FELICITATIONS ===== */
.congrats{
  background:var(--glass);
  border:1px solid var(--border);
  border-radius:14px;
  padding:12px 16px;
  box-shadow:var(--shadow);
  backdrop-filter:blur(10px);
  font-weight:950;
}
.congrats span{ color:var(--gold); }

/* ===== PANEL ===== */
.panel{
  background:var(--glass2);
  border:1px solid var(--border);
  border-radius:18px;
  padding:14px;
  box-shadow:var(--shadow);
  backdrop-filter:blur(12px);
  position:relative;
  overflow:hidden;
}

.rowMain{
  display:flex;
  gap:18px;
  align-items:center;
}

.avatar{
  width:min(260px,34vw);
  max-height:60vh;
  object-fit:contain;
  filter:drop-shadow(0 26px 38px rgba(0,0,0,.35));
}

.content{ flex:1; }

.topline{
  display:flex;
  align-items:center;
  gap:12px;
}

/* ===== BADGE FINAL (place normale) ===== */
.badgeSlot{
  position:relative;
  width:56px;
  height:56px;
}
.badgeFinal{
  width:56px;
  height:56px;
  object-fit:contain;
  filter:drop-shadow(0 14px 28px rgba(0,0,0,.35));
}

/* ===== BADGE FULLSCREEN ===== */
.badgeFullscreen{
  position:fixed;
  inset:0;
  display:grid;
  place-items:center;
  z-index:999;
  pointer-events:none;
  background:radial-gradient(circle at center,
    rgba(255,200,80,.12),
    rgba(0,0,0,.85) 65%);
}

.badgeFullscreen img{
  width: min(70vw, 420px);
  filter:
    drop-shadow(0 40px 90px rgba(0,0,0,.75))
    drop-shadow(0 0 80px rgba(255,200,80,.35));
  animation: badgeZoomOut 1.8s cubic-bezier(.18,.9,.22,1) forwards;
}

/* ===== ANIMATION PLEIN √âCRAN ‚Üí ARRI√àRE ===== */
@keyframes badgeZoomOut{
  0%{
    transform: scale(2.8);
    opacity:0;
    filter:blur(6px);
  }
  25%{
    transform: scale(1.6);
    opacity:1;
    filter:blur(0);
  }
  70%{
    transform: scale(.9);
    opacity:1;
  }
  100%{
    transform: scale(.2) translate(220px,-120px);
    opacity:0;
  }
}

/* ===== TEXTE ===== */
.title{
  font-size:22px;
  font-weight:950;
}
.para{
  margin-top:8px;
  font-size:12.5px;
  opacity:.85;
}

.pill{
  display:inline-block;
  padding:6px 9px;
  border-radius:999px;
  background:rgba(255,255,255,.06);
  border:1px solid rgba(255,255,255,.1);
  font-size:11px;
  font-weight:900;
  margin:0 6px 6px 0;
}

/* ===== CONFETTI ===== */
.confetti{
  position:absolute;
  inset:0;
  pointer-events:none;
}
.confetti i{
  position:absolute;
  top:-10px;
  width:8px;
  height:14px;
  animation:fall 1.6s ease forwards;
}
@keyframes fall{
  10%{opacity:1}
  100%{transform:translateY(520px) rotate(260deg);opacity:0}
}

@media(max-width:900px){
  .rowMain{flex-direction:column}
}
</style>
</head>

<body>
<div class="stage">
<div class="wrap">

<div class="congrats">
  üéâ F√©licitations <span id="playerName">Dr. Joueur</span>
</div>

<div class="panel">
  <div class="confetti" id="confetti"></div>

  <div class="rowMain">
    <img id="avatarImg" class="avatar">

    <div class="content">
      <div class="topline">
        <div class="badgeSlot">
          <img id="badgeFinal" class="badgeFinal">
        </div>
        <div class="title">FIN ‚Äî BADGE OBTENU</div>
      </div>

      <div id="para" class="para"></div>
    </div>
  </div>
</div>

</div>
</div>

<!-- BADGE FULLSCREEN -->
<div class="badgeFullscreen" id="badgeFullscreen">
  <img id="badgeBig">
</div>

<script>
/* ===== AUDIO ===== */
let audioCtx;
function ensureAudio(){
  if(!audioCtx) audioCtx=new (window.AudioContext||window.webkitAudioContext)();
}
function tone(f,d=.1){
  ensureAudio();
  const o=audioCtx.createOscillator(),g=audioCtx.createGain();
  o.frequency.value=f;
  g.gain.value=.05;
  o.connect(g);g.connect(audioCtx.destination);
  o.start();o.stop(audioCtx.currentTime+d);
}
function victorySound(){
  tone(523,.12);setTimeout(()=>tone(659,.12),120);
  setTimeout(()=>tone(784,.14),240);
}

/* ===== DATA ===== */
const BADGE_IMAGES={OR:"or.png",ARGENT:"argent.png",BRONZE:"bronze.png"};

const BADGE_DATA={
  player:localStorage.getItem("playerName")||"Joueur",
  score:+localStorage.getItem("score")||0,
  difficulty:(localStorage.getItem("niveau")||"D√âBUTANT").toUpperCase(),
  scenario:localStorage.getItem("scenario_label")||"Sc√©nario 3 ‚Äî Chute du 2e √©tage"
};
BADGE_DATA.level =
  BADGE_DATA.score>=130?"OR":
  BADGE_DATA.score>=95?"ARGENT":"BRONZE";

BADGE_DATA.img = BADGE_IMAGES[BADGE_DATA.level];

/* ===== INIT ===== */
document.getElementById("playerName").textContent="Dr. "+BADGE_DATA.player;
document.getElementById("avatarImg").src=
  localStorage.getItem("hero_avatar")||"assets/avatars/medecin_f.png";

document.getElementById("badgeFinal").src = BADGE_DATA.img;
document.getElementById("badgeBig").src   = BADGE_DATA.img;

document.getElementById("para").innerHTML=`
  <span class="pill">üéÆ ${BADGE_DATA.scenario}</span>
  <span class="pill">üèÖ ${BADGE_DATA.level}</span>
  <span class="pill">‚≠ê ${BADGE_DATA.score}</span>
  <span class="pill">üéö ${BADGE_DATA.difficulty}</span>
`;

/* confetti */
(function(){
  const c=document.getElementById("confetti");
  const colors=["#ffc850","#ff9646","#50aaff","#2dc878"];
  for(let i=0;i<16;i++){
    const p=document.createElement("i");
    p.style.left=Math.random()*90+"%";
    p.style.background=colors[Math.floor(Math.random()*colors.length)];
    c.appendChild(p);
  }
})();

/* son + disparition fullscreen */
window.addEventListener("pointerdown",()=>{
  ensureAudio();victorySound();
},{once:true});

setTimeout(()=>{
  document.getElementById("badgeFullscreen").style.display="none";
},1800);
</script>
</body>
</html>
